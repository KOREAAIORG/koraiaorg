/*
 * ===========================================================================================
 * MERGED: /Users/bruce/Dev/study/totaljs/messanger/public/js/jctajr.min.js
 * ===========================================================================================
 */

/*! jComponent v10.0.0 | (c) Peter Sirka | www.petersirka.com */
var Tangular={};Tangular.helpers={},Tangular.version='v1.9.0',Tangular.cache={},Tangular.ENCODE=/[<>&"]/g,Tangular.TRIM=/\n$/g,Tangular.debug=!1,Tangular.settings={delimiters:['{{','}}']},Tangular.i={},Tangular.i.white=/\W/,Tangular.i.numbers={0:1,1:1,2:1,3:1,4:1,5:1,6:1,7:1,8:1,9:1},Tangular.i.allow={$:1,'.':1},Tangular.register=function(n,r){return Tangular.helpers[n]=r,Tangular},Tangular.compile=function(n){n||(n='');for(var r,e=-1,a=[],t=-1,u=0,l=n.length,i=0,s=Tangular.settings.delimiters[0].length,g=[],o=-1;l>e++;){var c=n.substring(e,e+s);if(t===-1)if(c!==Tangular.settings.delimiters[0]);else{if(t!==-1){i++;continue}r=n.substring(u,e),r&&(o=g.indexOf(r),o===-1&&(o=g.length,g.push(r))),a.push(r?'txt['+o+']':'""'),t=e+s}else if(c===Tangular.settings.delimiters[1]){if(i>0){i--;continue}var f=n.substring(t,e).trim(),h=f.substring(0,3);if('if '===h||'for'===h||'end'===f||'fi'===f||'else'===f||'else if'===f){var p=g.length-1;g[p]&&(g[p]=g[p].replace(Tangular.TRIM,''))}a.push(f),u=e+s,t=-1;continue}}r=n.substring(u,l),r&&(o=g.indexOf(r),o===-1&&(o=g.length,g.push(r))),a.push(r?'txt['+o+']':'""'),l=a.length;for(var T='$output+=',d='var $s=this,$output="",$t,$v;',$=[],v=!1,b=0,m=0;m<l;m++)if(m%2!==0){var f=a[m],w=!1,e=f.lastIndexOf('|'),x=null,O=f.substring(0,3);'if '===O&&(f='if( '+f.substring(3)+'){',w=!0),'foreach '===f.substring(0,8)&&(x=f.split(' '),'var'===x[1]&&x.splice(1,1),$.push(x[1]),w=!0,v=!0,b++);var j=f.substring(0,5);if('endif'===j||'fi'===f?(f='}',w=!0):'else'===j?(f='}else{',w=!0):'else if'===f.substring(0,7)?(f='}else if( '+f.substring(8)+'){',w=!0):'end'!==O&&'endfor'!==f.substring(0,6)||(f=$.length?'}})()}':'}}',$.pop(),w=!0,b--,b||(v=!1)),f=w?Tangular.append(f,$,v,'$s').trim():Tangular.helper(f,$,v,'$s'),w){if(x){var C=Tangular.append(x[3],$,v,'$s');f='if ('+C+'&&'+C+'.length){(function(){for(var i=0,length='+C+'.length;i<length;i++){var '+x[1]+'='+C+'[i];var $index=i;'}d+=f}else d+=T+f+';'}else d+=T+a[m]+';';var E=59===d.charCodeAt(d.length-1);return Tangular.debug&&(console.log('Tangular:'),console.log('function(helpers,$){'+d+(E?'':';')+'return $output;'),console.log(n.trim()),console.log('---------------------------'),console.log('')),function(n,r){return new Function('helpers','$','txt',d+(E?'':';')+'return $output;').call(n,Tangular.helperhandling,r,g)}},Tangular.helperhandling=function(n){var r=Tangular.helpers[n];return r?r:(console.warn('Tangular helper "'+n+'" not found.'),function(n){return void 0===n?'undefined':null===n?'null':n.toString()})},Tangular.helper=function(n,r,e){var a,t=n.indexOf('|');if(t===-1)return a=Tangular.append(n.trim(),r,e,'$s').trim(),'helpers("encode").call($s,'+a+')';a=Tangular.append(n.substring(0,t).trim(),r,e).trim(),n=n.substring(t+1).trim().split('|');for(var u='',l=0,i=n.length;l<i;l++){var s,g=n[l].trim().replace('()','');t=g.indexOf('('),t===-1?(s=g,g='.call($s,$t)'):(s=g.substring(0,t),g='.call($s,$t,'+g.substring(t+1)),g='$t=helpers("'+s+'")'+g,u+=g+';'}return'"";$t='+a+';'+u+'$output+=$t'},Tangular.parse=function(n,r){for(var e=[],a=null,t=[],u=0,l=n.length;u<l;u++){var i=n.substring(u,u+1);i!==a?a?t.push(i):'\''!==i&&'"'!==i?!Tangular.i.numbers[i]||e.length?Tangular.i.allow[i]||!Tangular.i.white.test(i)?' '!==i?e.push(i):t.push(i):(e.length&&(t.push(r(e.join(''))),e=[]),t.push(i)):t.push(i):(e.length&&(t.push(r(e.join(''))),e=[]),a=i,t.push(i)):(a=null,e=[],t.push(i))}return e.length&&t.push(r(e.join(''))),t.join('')},Tangular.append=function(n,r,e,a){return void 0===r&&(r=[]),n?Tangular.parse(n,function(n){switch(n.trim()){case'else':case'end':case'endfor':case'endif':case'fi':case'foreach':case'if':case'true':case'false':case'else if':return n;case'$index':return n}for(var e=!1,t=0,u=r.length;t<u;t++){var l=r[t].length;if(n.substring(0,l)===r[t]){if(n.length!==l){var i=n.substring(l,l+1);if('.'!==i&&'+'!==i)continue}e=!0;break}}if('$'===n)return'Tangular.$wrap($)';if('$.'===n.substring(0,2)&&(a='$',n=n.substring(2)),e)return n;i=n.substring(0,1);var s=i.charCodeAt(0);return s>47&&s<58?n:'Tangular.$wrap('+(a||'$s')+',"'+n+'")'}):'Tangular.$wrap('+(a||'$s')+')'},Tangular.$wrap=function(n,r){if(!n||!r)return n;var e=Tangular.cache[r];if(null===e)return n[r];if(e)return e(n);if(1===r.split('.').length)return Tangular.cache[r]=null,n[r];try{e=Tangular.cache[r]=new Function('XYZ','try{return XYZ.'+r+'}catch(e){return ""}')}catch(n){e=new Function('return ""')}return e(n)},Tangular.render=function(n,r,e){return null==r&&(r={}),'string'==typeof n&&(n=Tangular.compile(n)),n(r,e)},Tangular.register('encode',function(n){return null==n?'':n.toString().replace(Tangular.ENCODE,function(n){switch(n){case'&':return'&amp;';case'<':return'&lt;';case'>':return'&gt;';case'"':return'&quot;'}return n})}),Tangular.register('raw',function(n){return null==n?'':n}),window.Tangular=Tangular,window.Ta=Tangular;
Tangular.register('pluralize',function(r,e,t,a,n){return r||(r=0),'number'!=typeof r&&(r=parseFloat(r.toString().replace(/\s/g,'').replace(',','.'))),r.pluralize(e,t,a,n)}),Tangular.register('format',function(r,e,t,a){var n=typeof r;if(void 0===r||null===r)return'';if('number'===n||r instanceof Date)return r.format(e,t,a);'string'!==n&&(r=r.toString()),r=r.trim();for(var i=!1,o=0,f=0,u=0,l=r.length;l>u;u++){var g=r.charCodeAt(u);if(58===g||32===g||84===g){i=!0;break}if(45===g){if(o++,1===o)continue;i=!0;break}if(46===g){if(f++,1===f)continue;i=!0;break}}return i?r.parseDate().format(e||'dd.MM.yyyy'):r.parseFloat().format(e,t,a)});
function jRinit(){jR.async(),$.fn.jRouting=function(r){if(jR.hashtags||!jR.isModernBrowser)return this;var t=+$.fn.jquery.replace(/\./g,'');if(t>=300&&r===!0)throw Error('$(selector).jRouting() doesn\'t work in jQuery +3. Instead of this use jR.clientside(selector).');var n=function(r){r.preventDefault(),jR.redirect($(this).attr('href'))};return r?$(document).on('click',this.selector,n):this.filter('a').bind('click',n),this},$(document).ready(function(){jR.async(),jR.hashtags?jR.url=location.hash||JRFU.path(JRFU.prepareUrl(location.pathname)):jR.url=JRFU.path(JRFU.prepareUrl(location.pathname)),setTimeout(function(){jR.isReady=!0,jR.location(jR.url)},5),$(window).on('hashchange',function(){jR.isReady&&jR.hashtags&&jR.location(JRFU.path(location.hash))}),$(window).on('popstate',function(){if(jR.isReady&&!jR.hashtags){var r=JRFU.path(location.pathname);jR.url!==r&&jR.location(r)}})})}var JRFU={},jR={LIMIT_HISTORY:100,LIMIT_HISTORY_ERROR:100,version:'v3.0.0',cache:{},routes:[],history:[],errors:[],global:{},query:{},params:[],middlewares:{},repository:{},url:'',model:null,isFirst:!0,isReady:!1,isRefresh:!1,isModernBrowser:!!history.pushState,hashtags:!1,count:0};window.jR||(window.jR=jR),window.jRouting||(window.jRouting=jR),window.JRFU||(window.JRFU=JRFU),window.NAVIGATION||(window.NAVIGATION=jR),jR.remove=function(r){for(var t=[],n=0,e=jR.routes.length;n<e;n++)jR.routes[n].id!==r&&t.push(jR.routes[n]);return jR.routes=t,jR},jR.on=function(r,t){return ON(r,t),jR},jR.emit=function(){EMIT.apply(window,arguments)},jR.route=function(r,t,n,e){var i;if(t instanceof Array){var i=n;n=t,t=i}'function'==typeof n&&(i=e,e=n,n=i);var o=r.count('/')+(r.indexOf('*')===-1?0:10),a=jR._route(r.trim()),u=[];if('string'==typeof n&&(n=n.split(',')),r.indexOf('{')!==-1){o-=100;for(var R=0;R<a.length;R++)'{'===a[R].substring(0,1)&&u.push(R);o-=u.length}return jR.routes.remove(r),jR.routes.push({id:r,url:a,fn:t,priority:o,params:u,middleware:n||null,init:e,count:0,pending:!1}),jR.routes.sort(function(r,t){return r.priority>t.priority?-1:r.priority<t.priority?1:0}),jR},jR.middleware=function(r,t){return jR.middlewares[r]=t,jR},jR.refresh=function(){return jR.location(jR.url,!0)},jR.reload=function(){return jR.refresh()},jR.async=function(){if(window.jRoute&&window.jRoute.length){for(;;){var r=window.jRoute.shift();if(!r)break;r()}jR.is404&&jR.location(jR.url)}},jR._route=function(r){47===r.charCodeAt(0)&&(r=r.substring(1)),47===r.charCodeAt(r.length-1)&&(r=r.substring(0,r.length-1));var t=r.split('/');return 1!==t.length||t[0]||(t[0]='/'),t},jR._route_param=function(r,t){var n=[];if(!t||!r)return n;var e=t.params.length;if(e)for(var i=0;i<e;i++){var o=r[t.params[i]];n.push('/'===o?'':o)}return n},jR._route_compare=function(r,t){var n=r.length,e=1===n&&'/'===r[0];if(t.length!==n)return!1;for(var i=0;i<n;i++){var o=t[i];if(!o)return!1;if(e||123!==o.charCodeAt(0)){if('*'===o)return!0;if(r[i]!==o)return!1}}return!0},jR.location=function(r,t){if(jR.isReady){var n=r.indexOf('?');n!==-1&&(r=r.substring(0,n)),r=JRFU.prepareUrl(r),r=JRFU.path(r);var e=jR._route(r),i=[],o=!0,a=[];a.push.apply(a,e);for(var u=0,R=e.length;u<R;u++)e[u]=e[u].toLowerCase();jR.isRefresh=t||!1,jR.count++,!t&&jR.url.length&&jR.history[jR.history.length-1]!==jR.url&&(jR.history.push(jR.url),jR.history.length>jR.LIMIT_HISTORY&&jR.history.shift());for(var R=jR.routes.length,u=0;u<R;u++){var s=jR.routes[u];if(jR._route_compare(e,s.url)&&(s.url.indexOf('*')===-1&&(o=!1),!(s.once&&s.count>0))){s.count++,i.push(s);break}}var j=!1,l=[];jR.url.length&&(jR.cache[jR.url]=jR.repository),jR.url=r,jR.repository=jR.cache[r],jR.repository||(jR.repository={}),jR._params(),jR.params=jR._route_param(a,s),jR.is404=!1,jR.emit('location',r),R=i.length;for(var u=0;u<R;u++){var s=i[u];if(!s.pending)if(s.middleware&&s.middleware.length)!function(r){for(var t=r.middleware.length,n=[],e=0;e<t;e++)!function(r,t){n.push(function(n){t.call(jR,n,r)})}(r,jR.middlewares[r.middleware[e]]);return r.init?(r.pending=!0,r.init(function(){n.middleware(function(t){!t&&r.fn.apply(jR,jR.params),r.pending=!1})}),void(r.init=null)):(r.pending=!0,void n.middleware(function(t){!t&&r.fn.apply(jR,jR.params),r.pending=!1}))}(s);else{if(!s.init){s.fn.apply(jR,jR.params);continue}s.pending=!0,function(r){r.init(function(){r.fn.apply(jR,jR.params),r.pending=!1})}(s),s.init=null}}j&&jR.status(500,l),jR.is404=!0,o&&jR.status(404,new Error('Route not found.'))}},jR.prev=function(){return jR.history[jR.history.length-1]},jR.back=function(){var r=jR.history.pop()||'/';return jR.url='',jR.redirect(r,!0),jR},jR.status=function(r,t){return EMIT(r,t),jR},jR.redirect=window.REDIRECT=function(r,t){return 35===r.charCodeAt(0)?(location.hash=r,jR.model=t||null,jR.location(r,!1),jR):jR.isModernBrowser?(history.pushState(null,null,r),jR.model=t||null,jR.location(r,!1),jR):(location.href=r,!1)},jR._params=function(){for(var r={},t=location.href.slice(location.href.indexOf('?')+1).split('&'),n=0;n<t.length;n++){var e=t[n].split('=');if(2===e.length){var i=decodeURIComponent(e[0]),o=decodeURIComponent(e[1]),a=r[i]instanceof Array;r[i]&&!a&&(r[i]=[r[i]]),a?r[i].push(o):r[i]=o}}return jR.query=r,jR},jR.path=JRFU.path=function(r,t){if('#'===r.substring(0,1))return r;t||(t='/');var n=r.indexOf('?'),e='';n!==-1&&(e=r.substring(n),r=r.substring(0,n));var i=r.length,o=r.substring(i-1,i);return o!==t&&(r+=t),r+e},JRFU.prepareUrl=function(r){if('#'===r.substring(0,1))return r;var t=r.indexOf('#');return t!==-1?r.substring(0,t):r},Array.prototype.middleware||(Array.prototype.middleware=function(r){var t=this,n=t.shift();return void 0===n?(r&&r(),t):(n(function(n){n instanceof Error||n===!1?r&&r(n===!1||n):setTimeout(function(){t.middleware(r)},1)}),t)}),String.prototype.count||(String.prototype.count=function(r){var t=0,n=0;do t=this.indexOf(r,t+r.length),t>0&&n++;while(t>0);return n}),jR.clientside=function(r){return $(document).on('click',r,function(r){r.preventDefault();var t=$(this),n=t.attr('href')||t.attr('data-jrouting')||t.attr('data-jr');'javascript:void(0)'!==n&&'#'!==n&&jR.redirect(n)}),jR},window.jQuery?jRinit():jR.init=setInterval(function(){window.jQuery&&(clearInterval(jR.init),jRinit())},100),setTimeout(jR.async,500),setTimeout(jR.async,1e3),setTimeout(jR.async,2e3),setTimeout(jR.async,3e3),setTimeout(jR.async,5e3),window.ROUTE=function(r,t,n,e){return jR.route(r,t,n,e)};
!function(){function t(t,e){L(t,e,1),S(t,e,1)}function e(){if(yt&&yt.length)for(var t=lt.orientation?90===Math.abs(lt.orientation)?'landscape':'portrait':'',e=$(lt),n=e.width(),r=e.height(),i=ut.defaults.devices,a=0,o=yt.length;o>a;a++){var s=yt[a],u=n,c=r;if(s.element&&(u=s.element.width(),c=s.element.height()),s.orientation){if(!t&&'portrait'!==s.orientation)continue;if(t!==s.orientation)continue}if(!(s.minW&&s.minW>=u||s.maxW&&s.maxW<=u||s.minH&&s.minH>=c||s.maxH&&s.maxH<=c||s.oldW===u&&s.oldH!==c&&!s.maxH&&!s.minH||s.oldH===c&&s.oldW!==u&&!s.maxW&&!s.minW||s.oldW===u&&s.oldH===c)){var l;u>=i.md.min&&u<=i.md.max?l='md':u>=i.sm.min&&u<=i.sm.max?l='sm':u>i.lg.min?l='lg':u<=i.xs.max&&(l='xs'),s.oldW=u,s.oldH=c,s.fn(u,c,l,s.id)}}}function n(t,e,n,r){var i=t.indexOf(' #');if(-1===i)return void r(t,e);var a=t.substring(0,i);void 0===e&&(e=P(a)),lt.MIDDLEWARE(t.substring(i+1).trim().replace(/\#/g,'').split(' '),e,function(t){r(a,t)},a)}function r(t,e,n){if(t.value!==e){if(t.value!==t.$value2){var r=!1;if(9!==n.keyCode&&(t.$com.$dirty&&(r=!0),t.$com.dirty(!1,!0)),t.$com.getter(t.value,2,r,e,'focusout'===n.type||13===n.keyCode),'INPUT'===t.nodeName||'TEXTAREA'===t.nodeName){var o=t.$com.formatter(t.value);if(t.value!==o){var s=a(t);t.value=o,i(t,s)}}t.$value2=t.value}setTimeout2('$jckp'+t.$com.id,function(){t.$value2=t.$value=void 0},3e5)}}function i(t,e){if(t.createTextRange){var n=t.createTextRange();return n.move('character',e),n.select(),!0}return t.selectionStart||!t.selectionStart?(t.focus(),t.setSelectionRange(e,e),!0):void 0}function a(t){if(document.selection){var e=document.selection.createRange();return e.moveStart('character',-t.value.length),e.text.length}return t.selectionStart||!t.selectionStart?t.selectionStart:0}function o(t,e,n,r,i,a){var o=n+'='+r+'='+i,s=gt[o];if(void 0!==s)return s;if(0===n){for(var u=0,c=t.length;c>u;u++)if(void 0!==e[u])if(a){if(t[u]!==e[u].raw)return gt[o]=!1,!1}else if(t[u]!==e[u].path)return gt[o]=!1,!1;return gt[o]=!0,!0}if(1===n){if(t.length!==e.length)return!1;for(var u=0,c=e.length;c>u;u++)if(t[u]!==e[u].raw)return gt[o]=!1,!1;return gt[o]=!0,!0}if(2===n){for(var u=0,c=t.length;c>u;u++)if(void 0!==e[u]&&t[u]!==e[u].raw)return gt[o]=!1,!1;return gt[o]=!0,!0}}function s(t,e){return e=e?'-'+e:'',t.getAttribute?t.getAttribute('data-jc'+e):t.attr('data-jc'+e)}function u(t,e){return e=e?'-'+e:'',t.getAttribute?t.getAttribute('data-ja'+e):t.attr('data-ja'+e)}function c(t,e,n,r){if(t=t?$(t).get(0):document.body){var i=u(t);!t.$app&&null!=i&&n(i,t,0),i=s(t),!t.$com&&null!=i&&e(i,t,0);var a=t.childNodes,o=[];void 0===r?r=0:r++;for(var l=0,f=a.length;f>l;l++){var d=a[l];if(d){if(!d.tagName)continue;d.childNodes.length&&'SCRIPT'!==d.tagName&&Q.test(d.innerHTML)&&o.push(d),d.$app||(i=u(d),null!=i&&n(i||'',d,r)),d.$com||(i=s(d),null!=i&&e(i||'',d,r))}}for(var l=0,f=o.length;f>l;l++)d=o[l],d&&c(d,e,n,r)}}function l(t){for(var e=-1,n=-1,r='',i='',a={};;){if(e=t.indexOf('<script',n),-1===e)break;if(n=t.indexOf('</script>',e),-1===n)break;var o=t.substring(e,n),e=o.indexOf('>')+1,s=o.substring(0,e);o=o.substring(e).trim(),ut.emit('app.compile',a,o),-1!==s.indexOf('markdown')?a.readme=o:-1!==s.indexOf('html')?-1!==s.indexOf('settings')?a.settings=o:(-1!==s.indexOf('body')||s.endsWith('"text/html">'))&&(a.html=o):r=o,n+=9}if(!o)return!1;e=t.indexOf('<style'),-1!==e&&(i=t.substring(t.indexOf('>',e)+1,t.indexOf('</style>')).trim());try{new Function('exports',r)(a)}catch(u){v('A problem with compiling application: {0}.'+u.toString())}if(!a.name||!a.install)return!1;var c=a.name;if(i&&($('#appcss_'+a.name).remove(),$('<style type="text/css" id="appcss_{0}">'.format(a.name)+i+'</style>').appendTo('head')),ut.$apps[c]){var l=ut.$apps[c];try{l.uninstall&&l.uninstall(!0)}catch(u){v('A problem with uninstalling application "{0}": {1}.'.foramt(c,u.toString()))}ut.$apps[c]=a;var f=ut.apps.slice(0);f.waitFor(function(t,e){return t.name!==c?e():(t.remove(!0),void e())})}else ut.$apps[c]=a;return!0}function f(){if(clearTimeout(jt),ut.defaults.localstorage){var t;try{t=localStorage.getItem(ut.$localstorage+'.cache'),t&&'string'==typeof t&&(dt=PARSE(t))}catch(e){}try{t=localStorage.getItem(ut.$localstorage+'.blocked'),t&&'string'==typeof t&&(ft=PARSE(t))}catch(e){}}if(dt){var n=dt.$jcpath;n&&Object.keys(n.value).forEach(function(t){ut.set(t,n.value[t],!0)})}lt.jQuery&&setTimeout(d,2),ut.loaded=!0}function d(t){if('string'==typeof t)return void l(t);if(st.is)return void(st.recompile=!0);var e=[];if(lt.READY&&e.push.apply(e,lt.READY),lt.jComponent&&e.push.apply(e,lt.jComponent),lt.components&&e.push.apply(e,lt.components),e.length)for(;;){var n=e.shift();if(!n)break;n()}if(st.is=!0,m(),st.pending.length)return void function(t){st.pending.push(function(){d(t)})}(t);var r=$(tt),i=r.length,a=!1;return c(t,function(t,e){var n=$(e);if(a=!0,Rt['$ST_'+t])return void g(n);var o=[],u=t.split(',');u.forEach(function(t){t=t.trim();var a=ut.$components[t||''];if(!a){var c=s(n,'import');if(!c)return void(!Rt['$NE_'+t]&&(Rt['$NE_'+t]=!0));if(1===st.imports[c])return;return 2===st.imports[c]?void(!Rt['$NE_'+t]&&(Rt['$NE_'+t]=!0)):(st.imports[c]=1,void ut['import'](c,function(){st.imports[c]=2}))}var l=a(n);l.init&&(Rt[t]||(Rt[t]=!0,l.init()),l.init=void 0),l.$init=s(n,'init')||null,l.type=s(n,'type')||'',l.id=s(n,'id')||l._id,l.siblings=u.length>1,e.$com=l,l.$noscope||(l.$noscope='true'===s(n,'noscope'));var f=l.path?l.path.charCodeAt(0):0;if(!l.$noscope&&i&&l.path&&33!==f&&35!==f)for(var d=0;i>d;d++)if($.contains(r[d],e)){var p=r[d].$cope||s(r[d],'scope');if(r[d].$initialized=!0,!r[d].$processed){r[d].$processed=!0,p&&'?'!==p||(p=GUID(25).replace(/\d/g,''),r[d].$cope=p);var h=s(r[d],'value');if(h){var m=new Function('return '+h);Ot['#'+lt.HASH(p)]=m,h=m(),L(p,h),S(p,h,1)}}l.setPath('?'===l.path?p:-1===l.path.indexOf('?')?p+'.'+l.path:l.path.replace(/\?/g,p)),l.scope=r[d],l.$controller=s(r[d],'controller'),l.pathscope=p}o.push(l);var g=s(n,'template')||l.template;if(g&&(l.template=g),'true'===s(n,'released')&&(l.$released=!0),s(n,'url'))return v('Components: You cannot use [data-jc-url] for the component: {0}[{1}]. Instead of it you have to use data-jc-template.'.format(l.name,l.path));if('string'==typeof g){var m=function(t){l.prerender&&(t=l.prerender(t)),'function'==typeof l.make&&l.make(t),A(n,l)},y=g.substring(0,1);if('.'===y||'#'===y||'['===y)return void m($(g).html());var b='TE'+lt.HASH(g),w=Rt[b];return w?m(w):void $.get(T(g),function(t){Rt[b]=t,m(t)})}return'string'==typeof l.make?-1!==l.make.indexOf('<')?(l.prerender&&(l.make=l.prerender(l.make)),n.html(l.make),void A(n,l)):void $.get(T(l.make),function(t){l.prerender&&(t=l.prerender(t)),n.html(t),A(n,l)}):(l.make&&l.make(),void A(n,l))}),n.data(rt,o.length>1?o:o[0])},function(t,e){var n=ut.$apps[t];if(n){var r=u(e,'id');r?p(n,r,e):v('Apps: The application "{0}" doesn\'t contain "data-ja-id" attribute.'.format(t))}},void 0),a&&st.pending.length||(st.is=!1),void 0===t&&Tt.length?void x(Tt,function(t,e){for(var n=0,r=t.toggle.length;r>n;n++)t.element.toggleClass(t.toggle[n]);e()},k):k()}function p(t,e,n){return $(n).data(rt,EMPTYOBJECT),1===t.$pending?void WAIT(function(){return t.$pending===!1},function(){h(t,e,n)}):void(void 0===t.$pending&&t.dependencies&&t.dependencies.length?(t.$pending=1,t.dependencies.waitFor(function(t,e){ut['import']('ONCE '+t,e)},function(){t.$pending=2,h(t,e,n)})):h(t,e,n))}function h(t,e,n){var r=$(n),i=e?'app.'+name+'.'+e+'.options':null;t.html&&r.empty().append(t.html),e='app'+lt.HASH(e);var a=new G(e,r,t,i);a.$cache=i,n.$app=a,r.data(rt,a),ut.apps.push(a),ut.emit('app.instance',a,t),Q.test(t.html)&&d(r);var o=u(r,'class');o&&(Tt.push({toggle:o.split(' '),element:r}),r.removeAttr('data-ja-class'))}function v(){lt.console&&lt.console.warn.apply(lt.console,arguments)}function m(){var t=[],e=0;if($(nt).each(function(){var e=$(this);if(!e.data(rt)){e.data(rt,'1');var n=u(e,'url'),r=n?n:s(e,'url'),i='once '===r.substring(0,5).toLowerCase();if('!'===r.substring(0,1)||i){if(r=r.substring(i?5:1),Rt[r])return;Rt[r]=2}var a={};a.url=r,a.element=e,a.callback=n?null:s(e,'init'),a.path=n?null:s(e,'path'),a.toggle=n?null:(s(e,'class')||'').split(' '),a.expire=(n?u(e,'cache'):s(e,'cache'))||ut.defaults.importcache,a.app=n?!0:!1,t.push(a)}}),t.length){var n=!1;x(t,function(t,r){var i=T(t.url),a=!1;AJAXCACHE('GET '+t.url,null,function(o){if(t.app)return l(o),n=!0,e++,r();if(i='$import'+i,Rt[i]&&(o=j(o)),a=o&&Q.test(o),(a||t.app)&&(n=!0),t.element.html(o),Rt[i]=!0,a&&t.path){var u=t.element.find(et);u.each(function(){var e=$(this);$.each(this.attributes,function(){this.specified&&e.attr(this.name,this.value.replace('$',t.path))})})}if(t.toggle.length&&t.toggle[0]&&Tt.push(t),t.callback&&!s(t.element)){var c=P(t.callback);'function'==typeof c&&c(t.element)}e++,r()},t.expire)},function(){F('valid','dirty','find'),e&&n&&d()})}}function g(t){var e=t.get(0);e.$com=null,e.$app=null,t.attr(it,!0),t.attr('data-ja-removed',!0),t.remove()}function y(t,e,n,r,i){n&&!n.version&&ut.$version&&(n.version=ut.$version),n&&!n.language&&ut.$language&&(n.language=ut.$language),n=STRINGIFY(n);var a=lt.HASH(t+'#'+e.replace(/\//g,'')+n).toString();return b(a,r,i)}function b(t,e,n){var r=Date.now();if(void 0!==e)return'session'===n?(ht['$session'+t]=e,e):('string'==typeof n&&(n=n.parseExpire()),dt[t]={expire:r+n,value:e},_(),e);var i=ht['$session'+t];return i?i:(i=dt[t],i&&i.expire>r?i.value:void 0)}function T(t){var e=t.indexOf('?'),n=[];return ut.$version&&n.push('version='+encodeURIComponent(ut.$version)),ut.$language&&n.push('language='+encodeURIComponent(ut.$language)),n.length?(t+=-1!==e?'&':'?',t+n.join('&')):t}function A(t,e){var n,r=t.get(0),i=r.tagName;'INPUT'===i||'SELECT'===i||'TEXTAREA'===i?(e.$input=!0,n=e.element):n=t.find(at),n.each(function(){!this.$com&&(this.$com=e)}),e.released&&e.released(e.$released),ut.components.push(e),st.init.push(e),'BODY'!==i&&Q.test(t.get(0).innerHTML)&&d(t),R()}function w(){var t=st.init.pop();void 0===t?!st.ready&&d():(!t.$removed&&E(t),w())}function E(t){if(t){var e,r=t.get(),i=t.element;pt[t.name]&&pt[t.name].forEach(function(e){e.call(t,t)}),t.setter&&(t.$prepared||(t.$prepared=!0,t.$ready=!0,e=s(t,'value'),e&&(Ot[e]||(Ot[e]=new Function('return '+e)),t.$default=Ot[e],void 0===r&&(r=t.$default(),L(t.path,r),S(t.path,r,0))),t.$binded?t.$interaction(0):(t.$binded=!0,n(t.middleware,r,1,function(e,n){t.setter(n,t.path,0),t.$interaction(0)})))),t.validate&&!t.$valid_disabled&&(t.$valid=t.validate(t.get(),!0)),t.done&&setTimeout(function(){t.done()},20),t.state&&t.state(0,3),t.$init&&setTimeout(function(){if(O(t.$init)){var e=OPERATION(t.$init);return e&&e.call(t,t),void(t.$init=void 0)}var n=P(t.$init);'function'==typeof n&&n.call(t,t),t.$init=void 0},5),i.trigger('component'),i.off('component');var a=s(i,'class');a&&function(t){setTimeout(function(){t=t.split(' ');for(var e=0,n=t.length;n>e;e++)i.toggleClass(t[e])},5)}(a),t.id&&ut.emit('#'+t.id,t),ut.emit('@'+t.name,t),ut.emit('component',t)}}function x(t,e,n){var r=t.shift();return null==r?n&&n():void e(r,function(){x(t,e,n)})}function k(){var t=st.pending.shift();t?t():st.ready&&(st.is=!1)}function O(t){return 35===t.charCodeAt(0)}function C(t){var e=t.lastIndexOf('[');return-1===e?!1:(t=t.substring(e+1,t.length-1).substring(0,1),!('"'===t||'\''===t))}function I(t,e,n){var r=mt[e];if(!r)return!1;if(r=r[t],!r)return!1;for(var i=0,a=r.length;a>i;i++){var o=r[i];(!o.path||o.path===e)&&o.fn.apply(o.context,n)}return!0}function S(t,e,n){Ft[0]=t,Ft[1]=e,Ft[2]=n,I('watch','*',Ft)}function N(t,e,n,r){for(var i={},a=Object.keys(e),o=0,s=a.length;s>o;o++)for(var u=a[o].split('.'),c='',l=0,f=u.length;f>l;l++)c+=(c?'.':'')+u[l],i[c]=e[c];S(r,i[r],n),Object.keys(i).forEach(function(e){Ft[1]=i[e],I(t,e,Ft)})}function D(t,e){if(e){for(var n=e.split('.'),r=[],i='watch'===t,a=i?3:arguments.length,o=i?1:2;a>o;o++)r.push(arguments[o]);i&&r.push(arguments[3]),i&&(Ft[0]=e,Ft[1]=P(e),Ft[2]=arguments[3],I(t,'*',Ft));for(var s='',o=0,a=n.length;a>o;o++){var u=n[o],c=n[o];if('*'!==u){if(']'===c.substring(c.length-1,c.length)){var l=c.lastIndexOf('[');c=c.substring(0,l)}s+=o?'.':'',r[1]=P(s+u),I(t,s+u,r),u!==c&&I(t,s+c,r),s+=u}}return!0}}function R(){setTimeout2('$ready',function(){e(),W(),w();var t=ut.components.length;if($(document).trigger('components',[t]),Mt||(Mt=!0,F('valid','dirty','find'),ut.emit('init'),ut.emit('ready')),setTimeout2('$initcleaner',function(){Y(),kt.splice(0).forEach(function(t){var e=t.element.find(at).eq(0),n=e.val();if(n){var r=t.parser(n);t.set(r),S(t.path,r,3)}})},1e3),st.is=!1,$(tt).each(function(){var t=this;if(t.$initialized&&!t.$ready){var e=$(t);t.$ready=!0;var n=s(e,'class');n&&!function(t){t=t.split(' '),setTimeout(function(){for(var n=0,r=t.length;r>n;n++)e.toggleClass(t[n])},5)}(n);var r=s(t,'controller');if(r){var i=CONTROLLER(r);i?i.$init(t.$scope,e):(!Et[r]&&v('Components: The controller "{0}" not found.'.format(r)),Et[r]=!0)}var a=s(t,'init');if(a)if(O(a)){var o=OPERATION(a);o?o.call(e,t.$scope,e):(!Et[a]&&v('Components: The operation {0} not found.'.format(a)),Et[a]=!0)}else{var u=P(a);'function'==typeof u&&u.call(e,t.$scope,e)}}}),st.recompile&&(st.recompile=!1,d()),st.ready){for(var n=st.ready,r=0,i=n.length;i>r;r++)n[r](t);st.ready=void 0}},100)}function j(t){return t.replace(V,function(t){var e=t.indexOf('>'),n=t.substring(0,e+1);return'<style'===n.substring(0,6)||'<script>'===n||-1!==n.indexOf('/javascript"')?'':t})}function M(t,e){return t.replace(q,function(t){return t=t.replace('<style>','<style type="text/css">'),e&&(t=t.replace('<style','<style '+e)),$(t).appendTo('head'),''})}function H(t,e){n(t,e,1,function(t,e){var n=t.replace('-->','->').indexOf('->');if(-1===n)return ut.set(t,e);var r=t.substring(0,n).trim(),i=t.substring(n+2).trim();ut.set(i,e[r])})}function L(t,e){if(35===t.charCodeAt(0)){var n=OPERATION(t);return void(n?n(e,t):(!Et[t]&&v('Components: The operation {0} not found.'.format(t)),Et[t]=!0))}var r='+'+t;if(vt[r])return vt[r](lt,e,t);if(-1!==t.indexOf('?'))return void(t='');for(var i=t.split('.'),a=[],o='',s=0,u=i.length;u>s;s++){o+=(''!==o?'.':'')+i[s];var c=C(i[s])?'[]':'{}';{if(s===u-1){if('{}'===c)break;o=o.substring(0,o.lastIndexOf('[')),a.push('if(!(w.'+o+' instanceof Array))w.'+o+'='+c);break}a.push('if(typeof(w.'+o+')!=="object"||w.'+o+'===null)w.'+o+'='+c)}}var l=new Function('w','a','b',a.join(';')+';var v=typeof(a)===\'function\'?a(MAIN.compiler.get(b)):a;w.'+t.replace(/\'/,'\'')+'=v;return v');return vt[r]=l,l(lt,e,t),st}function P(t,e){if(35===t.charCodeAt(0)){var n=OPERATION(t);return n?n:NOOP}var r='='+t;if(vt[r])return vt[r](e||lt);if(-1===t.indexOf('?')){for(var i=t.split('.'),a=[],o='',s=0,u=i.length-1;u>s;s++){var c=i[s],l=c.lastIndexOf('[');-1!==l&&a.push('if(!w.'+(o?o+'.':'')+c.substring(0,l)+')return'),o+=(''!==o?'.':'')+i[s],a.push('if(!w.'+o+')return')}var f=new Function('w',a.join(';')+';return w.'+t.replace(/\'/,'\''));return vt[r]=f,f(e||lt)}}function F(){if(!arguments.length)return void(ht={});for(var t=Object.keys(ht),e=0,n=t.length;n>e;e++){for(var r=t[e],i=!1,a=arguments,o=0;o<a.length;o++)if(r.substring(0,a[o].length)===a[o]){i=!0;break}i&&delete ht[r]}}function Y(){for(var t=Object.keys(mt),e=!0,n=0,r=t.length;r>n;n++){var i=t[n];if(mt[i])for(var a=Object.keys(mt[i]),o=0,s=a.length;s>o;o++){var u=a[o],c=mt[i][u];if(c)for(var l=0;;){var f=c[l++];if(void 0===f)break;null==f.context||f.context.element&&f.context.element.closest(document.documentElement).length||(f.context&&f.context.element&&f.context.element.remove(),f.context.$removed=!0,f.context=null,mt[i][u].splice(l-1,1),mt[i][u].length||(delete mt[i][u],Object.keys(mt[i]).length||delete mt[i]),l-=2,e=!0)}}}for(var l=0,d=ut.components.length;d>l;){var p=ut.components[l++];p?p.$removed||(p.element&&p.element.closest(document.documentElement).length&&!p.attr(it)?(p.$parser&&!p.$parser.length&&(p.$parser=void 0),p.$formatter&&!p.$formatter.length&&(p.$formatter=void 0)):(ut.emit('destroy',p.name,p),p.destroy&&p.destroy(),p.element.off(),p.element.find('*').off(),p.element.remove(),p.element=null,p.$removed=!0,p.path=null,p.setter=null,p.getter=null,p.make=null,l--,ut.components.splice(l,1),d=ut.components.length,e=!0)):(l--,ut.components.splice(l,1),d=ut.components.length)}for(var l=0,d=ut.apps.length;d>l;){var h=ut.apps[l++];h?h.element&&h.element.closest(document.documentElement).length||(ut.emit('destroy',h.name,h),h.emit('destroy'),h.destroy&&h.destroy(),h.element.off(),h.element.find('*').off(),h.element.remove(),h.element=null,h.$removed=!0,h.make=null,l--,ut.apps.splice(l,1),d=ut.apps.length):(l--,ut.apps.splice(l,1),d=ut.apps.length)}F('find'),lt.DATETIME=new Date;var v=lt.DATETIME.getTime(),m=!1,g=!1;for(var y in ft)ft[y]>v||(delete ft[y],m=!0);if(ut.defaults.localstorage&&m)try{localStorage.setItem(ut.$localstorage+'.blocked',JSON.stringify(ft))}catch($){}for(var y in dt){var f=dt[y];(!f.expire||f.expire<=v)&&(delete dt[y],g=!0)}g&&_(),e&&W()}function _(){try{ut.defaults.localstorage&&localStorage.setItem(ut.$localstorage+'.cache',JSON.stringify(dt))}catch(t){}}function W(){setTimeout2('$refresh',function(){ut.components.sort(function(t,e){if(t.$removed||!t.path)return 1;if(e.$removed||!e.path)return-1;var n=t.path.length,r=e.path.length;return n>r?-1:n===r?t.path.localeCompare(e.path):1})},200)}function X(t,e,n){t&&t.length&&setTimeout(function(){for(var r=0,i=t.length;i>r;r++)t[r].state(e,n)},2)}function J(t,e){var n=this;n.element=t,n.mapping=e,n.refresh()}function U(t,e,n){var r=this;r.id='v'+GUID(10),r.container=t,r.element=n,r.selector=e,r.length=n.length,!r.length&&r.$refresh()}function G(t,e,n,r){var i=this;i.$events={},i.id=t,i.scope=u(e,'scope')||s(e,'scope')||'app'+GUID(10),!u(e,'noscope')&&e.attr('data-jc-scope',i.scope),i.name=n.name,i.type=n.type,i.element=e,i.key=r,i.declaration=n,i.$load(function(t){i.options=$.extend(!0,CLONE(n.options),t||EMPTYOBJECT),n.install.call(i,i),i.make&&i.make()})}function B(t){this._id='component'+st.counter++,this.usage=new z,this.$dirty=!0,this.$valid=!0,this.$validate=!1,this.$parser=[],this.$formatter=[],this.$skip=!1,this.$ready=!1,this.$path,this.trim=!0,this.middleware='',this.$released=!1,this.name=t,this.path,this.type,this.id,this.disabled=!1,this.make,this.done,this.prerender,this.destroy,this.state,this.validate,this.released,this.release=function(t){var e=this;return void 0===t||e.$removed?e.$released:(e.element.find(et).each(function(){var n=$(this);n.attr('data-jc-released',t?'true':'false');var r=n.data(rt);r&&(r instanceof Array?r.forEach(function(n){n.$removed||n.$released===t||(r.$released=t,r.released&&r.released(t,e))}):r.$removed||r.$released===t||(r.$released=t,r.released&&r.released(t,e)))}),e.$released!==t&&(e.$released=t,e.released&&e.released(t,e)),t)},this.getter=function(t,e,n,r,i){var a=this;return t=a.parser(t),2!==e||i||(a.$skip=!0),2!==e||null!==r&&void 0!==r?(ut.validate(a.path),a):(a.trim&&'string'==typeof t&&(t=t.trim()),t===a.get()?(n&&ut.validate(a.path),a):(i&&(a.$skip=!1),a.getter2&&a.getter2.apply(a,arguments),a.set(a.path+a.middleware,t,e),a))},this.setter=function(t,e,n){var r=this;if(2===n&&r.$skip)return r.$skip=!1,r;r.setter2&&r.setter2.apply(r,arguments);var i=r.$input===!0?r.element:r.element.find(at),a='select-one';t=r.formatter(t),i.each(function(){var e=this,i=e.$com.path;if(!i||!i.length||i===r.path){if('checkbox'===e.type){var o=null!=t?t.toString().toLowerCase():'';return o='true'===o||'1'===o||'on'===o,void(o!==e.checked&&(e.checked=o))}if(null==t&&(t=''),n||e.type===a||'range'===e.type||t&&(!r.$default||r.$default()!==t)||kt.push(e.$com),e.type===a||'select'===e.type){var s=$(e);s.val()!==t&&s.val(t)}else e.value!==t&&(e.value=t)}})}}function z(){var t=this;t.init=0,t.manually=0,t.input=0,t['default']=0,t.custom=0,t.dirty=0,t.valid=0}var Q=/(data-ja|data-jc)\=/,V=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>|<style\b[^<]*(?:(?!<\/style>)<[^<]*)*<\/style>/gi,q=/<style\b[^<]*(?:(?!<\/style>)<[^<]*)*<\/style>/gi,Z=/\s/g,K=/,/g,tt='[data-jc-scope],[data-jc-controller]',et='[data-jc]',nt='[data-jc-url],[data-ja-url]',rt='jc',it='data-jc-removed',at='input[data-jc-bind],textarea[data-jc-bind],select[data-jc-bind]',ot={225:'a',228:'a',269:'c',271:'d',233:'e',283:'e',357:'t',382:'z',250:'u',367:'u',252:'u',369:'u',237:'i',239:'i',244:'o',243:'o',246:'o',353:'s',318:'l',314:'l',253:'y',255:'y',263:'c',345:'r',341:'r',328:'n',337:'o'},st={},ut={},ct={},lt=window,ft={},dt={},pt={},ht={},vt={},mt={},gt={},yt={},$t={},bt=[],Tt=[],At={},wt={},Et=[],xt={},kt=[],Ot={},Ct={},It={},St={},Nt={},Dt=[],Rt={},jt=setTimeout(f,2),Mt=!1,Ht=0,Lt=0,Pt=0,Ft=[null,null,null],Yt=[null,null];lt.MAIN=lt.M=lt.jC=lt.COM=ut,lt.APPS=lt.A=ct,lt.EMPTYARRAY=[],lt.EMPTYOBJECT={},lt.DATETIME=new Date,ut.defaults={},ut.defaults.delay=300,ut.defaults.keypress=!0,ut.defaults.localstorage=!0,ut.defaults.jsoncompress=!1,ut.defaults.jsondate=!0,ut.defaults.headers={'X-Requested-With':'XMLHttpRequest'},ut.defaults.devices={xs:{max:768},sm:{min:768,max:992},md:{min:992,max:1200},lg:{min:1200}},ut.defaults.importcache='session',ut.defaults.jsonconverter={'text json':function(t){return PARSE(t)}},ut.validators={},ut.validators.url=/^(http|https):\/\/(?:(?:(?:[\w\.\-\+!$&'\(\)*\+,;=]|%[0-9a-f]{2})+:)*(?:[\w\.\-\+%!$&'\(\)*\+,;=]|%[0-9a-f]{2})+@)?(?:(?:[a-z0-9\-\.]|%[0-9a-f]{2})+|(?:\[(?:[0-9a-f]{0,4}:)*(?:[0-9a-f]{0,4})\]))(?::[0-9]+)?(?:[\/|\?](?:[\w#!:\.\?\+=&@!$'~*,;\/\(\)\[\]\-]|%[0-9a-f]{2})*)?$/i,ut.validators.phone=/^[\+]?[(]?[0-9]{3}[)]?[-\s\.]?[0-9]{3}[-\s\.]?[0-9]{4,6}$/im,ut.validators.email=/^[a-zA-Z0-9-_.+]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/i,ut.regexp={},ut.regexp['int']=/(\-|\+)?[0-9]+/,ut.regexp['float']=/(\-|\+)?[0-9\.\,]+/,ut.regexp.date=/yyyy|yy|MM|M|dd|d|HH|H|hh|h|mm|m|ss|s|a|ww|w/g,ut.regexp.pluralize=/\#{1,}/g,ut.regexp.format=/\{\d+\}/g,ut.loaded=!1,ut.version='v10.0.0',ut.$localstorage='jc',ut.$version='',ut.$language='',ut.$components={},ut.components=[],ut.$apps={},ut.apps=[],ut.$formatter=[],ut.$parser=[],ut.compiler=st,st.is=!1,st.recompile=!1,st.pending=[],st.imports=[],st.init=[],st.imports={},st.ready=[],st.counter=0,Object.freeze&&(Object.freeze(EMPTYOBJECT),Object.freeze(EMPTYARRAY)),lt.MAN=st,lt.MAN.set=L,ut.compile=d,ut.clean=function(t){return setTimeout2('$clean',Y,t||10),ut},ut.evaluate=function(t,e,n){var r,i='eval'+e,a=gt[i];return r=n?t:P(t),void 0!==a?a.call(r,r,t):(-1===e.indexOf('return')&&(e='return '+e),a=new Function('value','path',e),gt[i]=a,a.call(r,r,t))},ut.cookies={get:function(t){for(var e=document.cookie.split(';'),n=0;n<e.length;n++){var r=e[n];' '===r.charAt(0)&&(r=r.substring(1));var i=r.split('=');if(i.length>1&&i[0]===t)return i[1]}return''},set:function(t,e,n){var r=typeof n;if('number'===r){var i=lt.DATETIME;i.setTime(i.getTime()+24*n*60*60*1e3),n=i}else'string'===r&&(n=new Date(Date.now()+n.parseExpire()));document.cookie=t+'='+e+'; expires='+n.toGMTString()+'; path=/'},rem:function(t){ut.set(t,'',-1)}},ut.formatter=function(t,e,n){if('function'==typeof t)return!ut.$formatter&&(ut.$formatter=[]),ut.$formatter.push(t),ut;var r=ut.$formatter;if(r&&r.length)for(var i=0,a=r.length;a>i;i++)t=r[i].call(ut,e,t,n);return t},ut.parser=function(t,e,n){if('function'==typeof t)return!ut.$parser&&(ut.$parser=[]),ut.$parser.push(t),this;var r=ut.$parser;if(r&&r.length)for(var i=0,a=r.length;a>i;i++)t=r[i].call(ut,e,t,n);return t},ut.upload=function(t,e,n,r,i){return t||(t=location.pathname),'number'==typeof n&&(r=n,n=void 0),setTimeout(function(){var r=new XMLHttpRequest,a={};a.process=!0,a.error=!1,a.upload=!0,a.method='POST',a.url=t,a.data=e,r.addEventListener('load',function(){var t=this.responseText;try{t=PARSE(t,ut.defaults.jsondate)}catch(e){}if(i&&('string'==typeof i?H(i,100):i(100)),a.response=t,a.status=this.status,a.error=200!==this.status,a.headers=this.getAllResponseHeaders(),ut.emit('response',a),a.process){if(!a.error)return'string'==typeof n?H(n,t):n&&n(t);t||(t=a.response=this.status+': '+this.statusText),ut.emit('error',a),a.process&&'function'==typeof n&&n({},t,a)}},!1),r.upload.onprogress=function(t){if(i){var e=0;t.lengthComputable&&(e=Math.round(100*t.loaded/t.total)),'string'==typeof i?H(i,e):i(e,t.transferSpeed,t.timeRemaining)}},r.open('POST',t),Object.keys(ut.defaults.headers).forEach(function(t){r.setRequestHeader(t,ut.defaults.headers[t])}),r.send(e)},r||0),ut},ut.ready=function(t){return st.ready?st.ready.push(t):t(),ut},ut.watch=function(t,e,n){return'function'==typeof t&&(n=e,e=t,t='*'),ON('watch',t,e),n&&e.call(ut,t,P(t),0),ut},ut.on=function(t,e,n,r){'function'==typeof e?(n=e,e='watch'===t?'*':''):e=e.replace('.*','');var i=null;return 33===e.charCodeAt(0)&&(e=e.substring(1),i=e),mt[e]?mt[e][t]||(mt[e][t]=[]):(mt[e]={},mt[e][t]=[]),mt[e][t].push({fn:n,id:this._id,path:i}),r&&n.call(ut,e,P(e),!0),!st.ready&&('ready'===t||'init'===t)&&n(),ut},ut.emit=function(t){var e=mt[''];if(!e)return!1;if(e=mt[''][t],!e)return!1;for(var n=[],r=1,i=arguments.length;i>r;r++)n.push(arguments[r]);for(var r=0,i=e.length;i>r;r++){var a=e[r].context;(void 0===a||null!==a&&!a.$removed)&&e[r].fn.apply(a||window,n)}return!0},ut.change=function(t,e){return void 0===e?!ut.dirty(t):!ut.dirty(t,!e)},ut.used=function(t){return ut.each(function(t){t.used()},t,!0),ut},ut.valid=function(t,e,n){var r,i=e instanceof Array,a='valid'+t+(i?'>'+e.join('|'):'');if(i&&(r=e,e=void 0),'boolean'!=typeof e&&void 0!==ht[a])return ht[a];var o=!0,s=void 0!==e?[]:null;return ut.each(function(a,u,c){if(!i||-1===r.indexOf(a.path)){if(a.disabled||a.$valid_disabled)return void(s&&a.state&&s.push(a));if(void 0===e)return void(a.$valid===!1&&(o=!1));a.state&&s.push(a),n?n._id===a._id&&(a.$valid=e,a.$interaction(102)):(c||a.path===t)&&(a.$valid=e,a.$validate=!1,a.$interaction(102)),a.$valid===!1&&(o=!1)}},t,!0),F('valid'),ht[a]=o,X(s,1,1),o},ut.dirty=function(t,e,n,r){var i,a=e instanceof Array,o='dirty'+t+(a?'>'+e.join('|'):'');if(a&&(i=e,e=void 0),'boolean'!=typeof e&&void 0!==ht[o])return ht[o];var s=!0,u=void 0!==e?[]:null;return ut.each(function(r,o,c){if(!a||-1===i.indexOf(r.path)){if(r.disabled||r.$dirty_disabled)return void(u&&r.state&&u.push(r));if(void 0===e)return void(r.$dirty===!1&&(s=!1));r.state&&u.push(r),n?n._id===r._id&&(r.$dirty=e,r.$interaction(101)):(c||r.path===t)&&(r.$dirty=e,r.$interaction(101)),r.$dirty===!1&&(s=!1)}},t,!0),F('dirty'),ht[o]=s,!r&&X(u,1,2),s},ut['import']=function(t,e,n,r,i){var a=t.substring(0,1),o='once '===t.substring(0,5).toLowerCase();'function'==typeof e?('function'==typeof n?(i=n,r=!0):'function'==typeof r&&(i=r,r=!0),n=e,e='body'):'function'==typeof r&&(i=r,r=!0),void 0===r&&(r=!0);var s=t.lastIndexOf(' .'),u='';if(-1!==s&&(u=t.substring(s).trim().toLowerCase(),t=t.substring(0,s).trim()),'!'===a||o){if(t=t.substring(o?5:1),Rt[t])return n?2===Rt[t]?(n(),ut):(WAIT(function(){return 2===Rt[t]},n),ut):ut;Rt[t]=1}if(e&&e.setPath&&(e=e.element),e||(e='body'),!u)if(s=t.lastIndexOf('?'),-1!==s){var c=t.lastIndexOf('.',s);-1!==c&&(u=t.substring(c,s).toLowerCase())}else s=t.lastIndexOf('.'),-1!==s&&(u=t.substring(s).toLowerCase());var l=document;if('.js'===u){var f=l.createElement('script');return f.type='text/javascript',f.async=!0,f.onload=function(){Rt[t]=2,n&&n(),lt.jQuery&&setTimeout(d,300)},f.src=t,l.getElementsByTagName('head')[0].appendChild(f),ut}if('.css'===u){var p=l.createElement('link');return p.type='text/css',p.rel='stylesheet',p.href=t,l.getElementsByTagName('head')[0].appendChild(p),Rt[t]=2,n&&setTimeout(n,200),ut}return WAIT(function(){return lt.jQuery?!0:!1},function(){Rt[t]=2;var a='';r&&(a='data-jc-imported="'+(1e5*Math.random()>>0)+'"',$(e).append('<div '+a+'></div>'),e=$(e).find('> div['+a+']'));var o=T(t);AJAXCACHE('GET '+o,null,function(t){o='$import'+o,i&&(t=i(t)),t=ht[o]?j(t):M(t,a),$(e).html(t),ht[o]=!0,setTimeout(function(){t&&Q.test(t)&&d(e),n&&n()},10)},ut.defaults.importcache)}),ut},ut.cachepath=function(t,e,n){var r='$jcpath';if(ut.watch(t,function(n,i){var a=b(r);a?a[t]=i:(a={},a[t]=i),b(r,a,e)}),void 0===n||n){var i=b(r);i&&void 0!==i[t]&&i[t]!==P(t)&&ut.set(t,i[t],!0)}return ut},ut.cache=function(t,e,n){return b(t,e,n)},ut.removeCache=function(t,e){if(e)for(var n in dt)-1!==n.indexOf(t)&&delete dt[t];else delete dt[t];return _(),ut},ut.usage=function(t,e,n,r){var i=typeof e;'string'===i?e=lt.DATETIME.add('-'+e):'number'===i&&(e=Date.now()-e),'function'==typeof n&&(r=n,n=void 0);var a=[];return n?ut.findByPath(n,function(n){n.usage[t]>e||(r?r(n):a.push(n))}):ut.components.forEach(function(n){n.usage[t]>e||(r?r(n):a.push(n))}),r?ut:a},ut.parseCookie=ut.parseCookies=function(){for(var t=document.cookie.split(';'),e={},n=0,r=t.length;r>n;n++){var i=t[n].trim(),a=i.indexOf('=');-1!==a&&(e[i.substring(0,a)]=decodeURIComponent(i.substring(a+1)))}return e},ut.createURL=function(t,e){'object'==typeof t&&(e=t,t=location.pathname+location.search);var n,r=t.indexOf('?');-1!==r?(n=ut.parseQuery(t.substring(r+1)),t=t.substring(0,r)):n={};for(var i=Object.keys(e),a=0,o=i.length;o>a;a++){var s=i[a];n[s]=e[s]}var u=$.param(n,!0);return t+(u?'?'+u:'')},ut.parseQuery=function(t){if(t||(t=location.search),!t)return EMPTYOBJECT;var e=t.indexOf('?');-1!==e&&(t=t.substring(e+1));for(var n=t.split('&'),r={},i=0,a=n.length;a>i;i++){var o=n[i].split('='),s=o[0],u=decodeURIComponent((o[1]||'').replace(/\+/g,'%20'));r[s]?(r[s]instanceof Array||(r[s]=[r[s]]),r[s].push(u)):r[s]=u}return r},ut.AJAX=function(t,e,r,i){'function'==typeof t&&(i=r,r=e,e=t,t=location.pathname);var a,o=typeof e;r||'function'!==o&&'string'!==o||(i=r,r=e,e=void 0);var s=t.indexOf(' ');if(-1===s)return ut;var u=t.substring(0,s).toUpperCase(),c='!'===u.substring(0,1);c&&(u=u.substring(1));var l={};a=t.match(/\{.*?\}/g),a&&(t=t.replace(a,'').replace(/\s{2,}/g,' '),a=new Function('return '+a)(),'object'==typeof a&&(l=a)),t=t.substring(s).trim(),s=t.indexOf(' #');var f='';return-1!==s&&(f=t.substring(s),t=t.substring(0,s)),setTimeout(function(){'GET'===u&&e&&(t+='?'+('string'==typeof e?e:jQuery.param(e,!0)));var i={};i.type=u,i.converters=ut.defaults.jsonconverter,'GET'!==u&&('string'==typeof e?i.data=e:(i.contentType='application/json; charset=utf-8',i.data=STRINGIFY(e))),t.match(/http\:\/\/|https\:\/\//i)&&(i.crossDomain=!0,c&&(i.xhrFields={withCredentials:!0})),i.headers=$.extend(l,ut.defaults.headers);var a=lt.HASH(t+STRINGIFY(i)),o=At[a];o&&(o.jcabort=!0,o.abort(),o=void 0);var s={};s.url=t,s.process=!0,s.error=!1,s.upload=!1,s.method=u,s.data=e,i.success=function(t,e,i){delete At[a],s.response=t,s.status=e,s.headers=i.getAllResponseHeaders(),ut.emit('response',s),s.process&&n(f,s.response,1,function(t,e){'string'==typeof r?H(r,e):r&&r(e,void 0,s)})},i.error=function(t,e,n){if(delete At[a],s.response=t.responseText,s.status=e+': '+n,s.error=!0,s.headers=t.getAllResponseHeaders(),-1!==s.headers.indexOf('/json'))try{s.response=PARSE(s.response,ut.defaults.jsondate)}catch(n){}ut.emit('response',s),s.process&&ut.emit('error',s),s.process&&'function'==typeof r&&r(s.response,s.status,s)},At[a]=$.ajax(T(t),i)},i||0),ut},ut.AJAXCACHEREVIEW=function(t,e,n,r,i,a){return AJAXCACHE(t,e,n,r,i,a,!0)},ut.AJAXCACHE=function(t,e,n,r,i,a,o){'function'==typeof t&&(i=n,n=e,e=t,t=location.pathname);var s=typeof e;if(n&&'number'!=typeof n||'function'!==s&&'string'!==s||(a=i,i=r,r=n,n=e,e=void 0),'boolean'==typeof i){var u=a;a=i,i=u}var c=t.indexOf(' ');if(-1===c)return ut;var l=t.substring(0,c).toUpperCase(),f=t.substring(c).trim();return setTimeout(function(){var i=a?void 0:y(l,f,e,void 0,r);if(void 0!==i){var s=o?STRINGIFY(i):null;if('string'==typeof n?H(n,i):n(i,!0),!o)return;return void AJAX(t,e,function(t,i){i&&(t=i),s!==STRINGIFY(t)&&(y(l,f,e,t,r),'string'==typeof n?H(n,t):n(t,!1,!0))})}ut.AJAX(t,e,function(t,i){i&&(t=i),y(l,f,e,t,r),'string'==typeof n?H(n,t):n(t,!1)})},i||1),ut},ut.schedule=function(t,e,n,r){'-'!==n.substring(0,1)&&(n='-'+n);var i=n.split(' '),a=i[1].toLowerCase().substring(0,1);return bt.push({name:e,expire:n,selector:t,callback:r,type:'y'===a||'d'===a?'h':a}),ut},ut.errors=function(t,e){t instanceof Array&&(e=t,t=void 0);
var n=[];return ut.each(function(t){e&&-1!==e.indexOf(t.path)||t.$valid!==!1||t.$valid_disabled||n.push(t)},t),n},ut.can=function(t,e){return!ut.dirty(t,e)&&ut.valid(t,e)},ut.disabled=ut.disable=function(t,e){return ut.dirty(t,e)||!ut.valid(t,e)},ut.invalid=function(t,e){return ut.dirty(t,!1,e,!0),ut.valid(t,!1,e),ut},ut.blocked=function(t,e,n){var r=t,i=ft[r],a=Date.now();if(i>a)return!0;var o=ut.defaults.localstorage&&e>1e4;ft[r]=a+e;try{o&&localStorage.setItem(ut.$localstorage+'.blocked',JSON.stringify(ft))}catch(s){}return n&&n(),!1},ut.update=function(t,e,r){var i=33===t.charCodeAt(0);return i&&(t=t.substring(1)),t=t.replace(/\.\*/,''),n(t,void 0,r,function(t){if(t){var a=[],o={},s=t;void 0===r&&(r=1);var u=s.split('.'),c=u.length,l=-1!==t.indexOf('[');ut.each(function(i){if(i.path&&!i.disabled){for(var s=!0,f=0;c>f;f++){var d=i.$$path[f];if(!d)return;if(l){if(d.raw!==u[f])return}else{if(d.path&&d.path!==u[f])return;d.is&&(s=!1)}}if(!s||!i.$path||i.$path===t){var p=i.get();i.setter&&(i.$skip=!1,n(i.middleware,p,r,function(e,n){i.setter(n,t,r)}),i.$interaction(r)),i.$ready=!0,e===!0?(i.$dirty_disabled||(i.$dirty=!0,i.$interaction(101)),i.$valid_disabled||(i.$valid=!0,i.$validate=!1,i.validate&&(i.$valid=i.validate(p),i.$interaction(102))),i.element.find(at).each(function(){this.$value=this.$value2=void 0})):i.validate&&!i.$valid_disabled&&i.valid(i.validate(p),!0),i.state&&a.push(i),o[i.path]=p}}},i?t:void 0,void 0,i),e&&F('dirty','valid'),o[t]||(o[t]=P(t));for(var f=0,d=a.length;d>f;f++)a[f].state(1,4);d=t.length,Object.keys(mt).forEach(function(e){(e===t||e.substring(0,d+1)===t+'.')&&(o[e]=P(e))}),N('watch',o,r,t)}}),ut},ut.notify=function(){var t=arguments,e=arguments.length;return ut.each(function(n){if(n.path&&!n.disabled){for(var r=!1,i=0;e>i;i++)if(n.path===t[i]){r=!0;break}if(r){var a=n.get();n.setter&&n.setter(a,n.path,1),n.setter2&&n.setter(a,n.path,1),n.$interaction(1)}}}),Object.keys(mt).forEach(function(n){for(var r=!1,i=0;e>i;i++)if(n===t[i]){r=!0;break}r&&(Yt[0]=n,Yt[1]=P(n),I('watch',n,Yt))}),ut},ut.extend=function(t,e,n){var r=P(t);return null==r&&(r={}),ut.set(t,$.extend(r,e),n),ut},ut.rewrite=function(e,r){return n(e,r,1,t),ut},ut.inc=function(t,e,n){var r=P(t);return r?'number'!=typeof r&&(r=parseFloat(r),isNaN(r)&&(r=0)):r=0,r+=e,ut.set(t,r,n),ut},ut.set=function(t,e,r){return n(t,e,r,function(t,i){var a=33===t.charCodeAt(0);if(a&&(t=t.substring(1)),43===t.charCodeAt(0))return t=t.substring(1),ut.push(t,i,r);if(!t)return ut;var o='object'==typeof i&&!(i instanceof Array)&&null!==i&&void 0!==i,s=r===!0;if(s&&(r=1),L(t,i,r),o)return ut.update(t,s,r);var u=e!==i,c=P(t),l=[];void 0===r&&(r=1);var f=t.split('.'),d=f.length;ut.each(function(e){if(e.path&&!e.disabled){for(var i=0;d>i;i++){var a=e.$$path[i];if(a&&a.raw!==f[i])return}e.$path&&e.$path!==t||(e.path===t?e.setter&&(u&&(e.$skip=!1),n(e.middleware,c,r,function(n,i){e.setter(i,t,r)}),e.$interaction(r)):e.setter&&(u&&(e.$skip=!1),n(e.middleware,P(e.path),r,function(n,i){e.setter(i,t,r)}),e.$interaction(r)),e.$ready=!0,e.state&&l.push(e),s?(e.$dirty_disabled||(e.$dirty=!0),e.$valid_disabled||(e.$valid=!0,e.$validate=!1,e.validate&&(e.$valid=e.validate(c),e.$interaction(102))),e.element.find(at).each(function(){this.$value=this.$value2=void 0})):e.validate&&!e.$valid_disabled&&e.valid(e.validate(c),!0))}},t,!0,a),s&&F('dirty','valid');for(var p=0,h=l.length;h>p;p++)l[p].state(r,5);D('watch',t,void 0,r,a)}),ut},ut.push=function(t,e,n){var r=P(t),i=!1;r instanceof Array||(r=[],i=!0);var a=!0;return e instanceof Array?e.length?r.push.apply(r,e):a=!1:r.push(e),i?ut.set(t,r,n):a&&ut.update(t,n),ut},ut.get=function(t,e){return P(t,e)},ut.remove=function(t){if(t instanceof jQuery){t.find(et).attr(it,'true').each(function(){var t=$(this).data(rt);t&&(t instanceof Array?t.forEach(function(t){t.$removed=!0}):t.$removed=!0)}),s(t,'template')&&t.attr(it,'true');var e=t.data(rt);return e&&(e instanceof Array?e.forEach(function(t){t.$removed=!0}):e.$removed=!0),setTimeout2('$cleaner',Y,100),ut}return F(),ut.each(function(t){t.remove(!0)},t),setTimeout2('$cleaner',Y,100),ut},ut.schema=function(t,e){if(!e)return $.extend(!0,{},xt[t]);if('object'==typeof e)return xt[t]=e,e;if('function'==typeof e){var n=e();return xt[t]=n,n}if('string'!=typeof e)return void 0;var r=e.substring(0,1),i=e.substring(e.length-1);if('"'===r&&'"'===i||'['===r&&']'===i||'{'===r&&'}'===i){var a=PARSE(e,ut.defaults.jsondate);return xt[t]=a,a}},ut.validate=function(t,e){var n=[],r=!0;return ut.each(function(t){t.disabled||e&&-1!==e.indexOf(t.path)||(t.state&&n.push(t),t.$valid_disabled||(t.$validate=!0,t.validate&&(t.$valid=t.validate(P(t.path)),t.$interaction(102),t.$valid||(r=!1))))},t),F('valid'),X(n,1,1),D('validate',t),r},ut['default']=function(t,e,n,r){if(e>0)return setTimeout(function(){ut['default'](t,0,n,r)},e),ut;'boolean'==typeof n&&(r=n,n=null),void 0===r&&(r=!0);var i,a=t.replace(/\.\*$/,''),o=Ot['#'+lt.HASH(a)];o&&(i=o(),L(a,i),S(a,i,3));var s=[];return ut.each(function(t){t.disabled||(t.state&&s.push(t),n&&n._id!==t._id||(t.$default&&t.path&&t.set(t.path,t.$default(),3),r&&(t.element.find(at).each(function(){this.$value=this.$value2=void 0}),t.$dirty_disabled||(t.$dirty=!0),t.$valid_disabled||(t.$valid=!0,t.$validate=!1,t.validate&&(t.$valid=t.validate(t.get()),t.$interaction(102))))))},t),D('default',t),r?(F('valid','dirty'),X(s,3,3),D('reset',t),ut):ut},ut.reset=function(t,e,n){if(e>0)return setTimeout(function(){ut.reset(t)},e),ut;var r=[];return ut.each(function(t){t.disabled||(t.state&&r.push(t),n&&n._id!==t._id||(t.element.find(at).each(function(){this.$value2=this.$value=void 0}),t.$dirty_disabled||(t.$dirty=!0,t.$interaction(101)),t.$valid_disabled||(t.$valid=!0,t.$validate=!1,t.validate&&(t.$valid=t.validate(t.get()),t.$interaction(102)))))},t),F('valid','dirty'),X(r,1,3),D('reset',t),ut},ut.findByPath=function(t,e){var n=typeof t;('function'===n||'boolean'===n)&&(e=t,t=void 0);var r,i=typeof e,a='function'===i,o='boolean'===i;return o&&(e=void 0,r=[]),ut.each(function(t){return a?e(t):o?void r.push(t):(r=t,!0)},t),a?ut:r},ut.findByName=function(t,e,n){return ut.findByProperty('name',t,e,n)},ut.findById=function(t,e,n){return ut.findByProperty('id',t,e,n)},ut.findByProperty=function(t,e,n,r){var i=typeof n;('function'===i||'boolean'===i)&&(r=n,n=void 0);var a,o=typeof r,s='function'===o,u='boolean'===o;return u&&(r=void 0,a=[]),ut.each(function(n){return n[t]===e?s?r(n):u?void a.push(n):(a=n,!0):void 0},n),s?ut:a},ut.each=function(t,e,n,r){var i=e?-1!==e.lastIndexOf('*'):!1;i&&(e=e.replace('.*',''));var a;a=e?e.split('.'):[];for(var s=0,u=e?-1!==e.indexOf('['):!1,c=0,l=ut.components.length;l>c;c++){var f=ut.components[c];if(!(!f||f.$removed||r&&f.path!==e)){if(e){if(!f.path)continue;if(i){var d=o(a,f.$$path,0,e,f.path,u);if(!d)continue}else if(e!==f.path){if(!n)continue;var d=o(a,f.$$path,2,e,f.path||'',u);if(!d)continue}}var p=t(f,s++,i);if(p===!0)return ut}}return ut},lt.TEMPLATE=function(t,e,n){return Rt[t]?('string'==typeof e?SET(e,Rt[t]):e(Rt[t]),ut):(AJAX('GET '+t,function(r,i){i&&(r='');var a=Rt[t]=n?n(r):r;'string'==typeof e?SET(e,a):e(a)}),ut)},ct.emit=function(t,e,n,r,i){for(var a=0,o=ut.apps.length;o>a;a++)ut.apps[a].emit.call(ut.apps[a],t,e,n,r,i);return ct},ct['import']=function(t,e){var n=t.indexOf(' ');return(-1===n||n>5)&&(t='GET '+t),AJAX(t,function(t){var n=t?l(t):!1;e&&e(n?null:new Error('Invalid jComponent application.'))}),ct},ct.compile=function(t){return l(t)},ct.save=function(){},st.get=P;var _t=J.prototype;_t.refresh=function(){for(var t=this,e=Object.keys(t.mapping),n=0,r=e.length;r>n;n++){var i=e[n];if('refresh'!==i){var a=t.mapping[i],o='function'==typeof a?a(t.element):t.element.find(a);t[i]?t[i].refresh():t[i]=new U(t,a,o instanceof jQuery?o:$(o))}else v('VIRTUALIZE can\'t contain field called "refresh" in mapping.')}return t};var Wt=U.prototype;Wt.refresh=function(){var t=this;return t.element='function'==typeof t.selector?t.selector(t.container.element):t.container.element.find(t.selector),t.length=t.element.length,t},Wt.replace=function(t){return this.element.replaceWith(t),this.element=t,this},Wt.$refresh=function(){var t=this;return t.length?t:(setTimeout(function(t){t.refresh(),t.$refresh()},200,t),t)},Wt.click=function(t){var e=this.element;return e.off('click touchend'),e.on('click touchend',t),this};var Xt=G.prototype;G.prototype.change=function(){return this.$save(),this},G.prototype.emit=function(t){var e=this.$events[t];if(e&&e.length)for(var n=0,r=e.length;r>n;n++)e[n].call(this,arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]);return this},G.prototype.on=function(t,e){var n=this.$events[t];return!n&&(this.$events[t]=n=[]),n.push(e),this},G.prototype.path=function(t){return this.scope+(t?'.'+t:'')},G.prototype.set=function(t,e,n){var r=this;return ut.set(r.path(t),e,n),r},G.prototype.update=function(t,e,n){var r=this;return ut.update(r.path(t),e,n),r},G.prototype.notify=function(t){var e=this;return ut.notify(e.path(t)),e},G.prototype.inc=function(t,e,n){var r=this;return ut.inc(r.path(t),e,n),r},G.prototype.push=function(t,e,n){var r=this;return ut.push(r.path(t),e,n),r},G.prototype.extend=function(t,e,n){var r=this;return ut.extend(r.path(t),e,n),r},G.prototype.rewrite=function(t,e){var n=this;return ut.rewrite(n.path(t),e),n},G.prototype['default']=function(t,e,n,r){var i=this;return ut['default'](i.path(t),e,n,r),i},G.prototype.get=function(t){return P(self.path(t))},G.prototype.attr=function(t,e){var n=this.element;return void 0===e?n.attr(t):(n.attr(t,e),this)},G.prototype.remove=function(t){var e=this;return e.destroy&&e.destroy(),e.emit('destroy'),e.element.removeData(rt),e.element.get(0).$app=null,t||(e.element.remove(),e.key&&ut.removeCache(e.key)),e.element.off(),ut.apps=ut.apps.remove(e),setTimeout2('$cleaner',Y,100),e},G.prototype.$load=function(t){var e=this;return t(e.key?ut.cache(e.key):null),e},G.prototype.$save=function(){var t=this;return t.key&&ut.cache(t.key,t.options,'1 year'),t};var Jt=B.prototype;Jt.controller=function(){return CONTROLLER(this.$controller)},Jt.replace=function(t){var e=this;return e.element=$(t),e.element.get(0).$com=e,e},Jt.compile=function(t){return d(t||this.element),this},Jt.nested=function(){var t=[];return this.find(et).each(function(){var e=$(this),n=e.data(rt);n&&!e.attr(it)&&(n instanceof Array?t.push.apply(t,n):t.push(n))}),t},Jt.$interaction=function(t){var e=Date.now(),n=this;switch(t){case 0:n.usage.init=e,n.$binded=!0;break;case 1:n.usage.manually=e,n.$binded=!0;break;case 2:n.usage.input=e,n.$binded=!0;break;case 3:n.usage['default']=e,n.$binded=!0;break;case 100:n.usage.custom=e;break;case 101:n.usage.dirty=e;break;case 102:n.usage.valid=e}return n},Jt.notify=function(){return lt.NOTIFY(this.path),this},Jt.update=Jt.refresh=function(t){var e=this;return t?e.set(e.get()):(e.setter&&e.setter(e.get(),e.path,1),e.$interaction(1)),e},Jt.classes=Xt.classes=Wt.classes=function(t){var e='cls.'+t,n=gt[e],r=this,i=r.element;if(n)return n.add&&i.addClass(n.add),n.rem&&i.removeClass(n.rem),r;for(var a=t instanceof Array?t:t.split(' '),o='',s='',u=0,c=a.length;c>u;u++){var l=a[u].substring(0,1);'-'===l?s+=(s?' ':'')+a[u].substring(1):o+=(o?' ':'')+('+'===l?a[u].substring(1):a[u])}return o&&i.addClass(o),s&&i.removeClass(s),t instanceof Array?r:(gt[e]={add:o,rem:s},r)},Jt.toggle=Xt.toggle=Wt.toggle=function(t,e,n){var r=!1,i=this;'string'!=typeof t&&(n=e,e=t,t='hidden',r=!0),'number'==typeof e?(n=e,e=void 0):r&&void 0!==e&&(e=!e);var a=i.element;return n?(setTimeout(function(){a.toggleClass(t,e)},n),i):(a.toggleClass(t,e),i)},Jt.noscope=function(t){return this.$noscope=void 0===t?!0:t===!0,this},Jt.singleton=function(){return Rt['$ST_'+this.name]=!0,this},Jt.blind=function(){var t=this;return t.path=null,t.$path=null,t.$$path=null,t},Jt.readonly=function(){var t=this;return t.noDirty(),t.noValid(),t.getter=null,t.setter=null,t.$parser=null,t.$formatter=null,t},Jt.noValid=Jt.noValidate=function(t){void 0===t&&(t=!0);var e=this;return e.$valid_disabled=t,e.$valid=t,e},Jt.noDirty=function(t){void 0===t&&(t=!0);var e=this;return e.$dirty_disabled=t,e.$dirty=t?!1:!0,e},Jt.setPath=function(t,e){var n=null,r=this;33===t.charCodeAt(0)&&(t=t.substring(1),n=t);var i=t.indexOf(' #');-1!==i?(r.middleware=t.substring(i),t=t.substring(0,i)):r.middleware='',r.path=t,r.$path=n;for(var a=t.split('.'),o=[],s=0,u=a.length;u>s;s++){var c=a[s],l=c;i=c.indexOf('['),-1!==i&&(c=c.substring(0,i)),o.push({path:c,raw:l,is:-1!==i})}return r.$$path=o,!e&&st.ready&&W(),r},Jt.attr=Xt.attr=Wt.attr=function(t,e){var n=this.element;return void 0===e?n.attr(t):(n.attr(t,e),this)},Jt.css=Xt.css=Wt.css=function(t,e){var n=this.element;return void 0===e?n.css(t):(n.css(t,e),this)},Jt.html=Xt.html=Wt.html=function(t){var e=this.element,n=e.html();if(void 0===t)return n;if(t instanceof Array&&(t=t.join('')),t===n)return e;var r=typeof t;return t||'number'===r||'boolean'===r?e.empty().append(t):e.empty()},Jt.empty=Xt.empty=Wt.empty=function(){var t=this.element;return t.empty(),t},Jt.append=Xt.append=Wt.append=function(t){var e=this.element;return t instanceof Array&&(t=t.join('')),t?e.append(t):e},Jt.event=Xt.event=Wt.event=Wt.on=function(){var t=this;return t.element.on.apply(t.element,arguments),t},Jt.find=Xt.find=Wt.find=function(t){return this.element.find(t)},Jt.virtualize=Xt.virtualize=function(t){return lt.VIRTUALIZE(this.element,t)},Jt.isInvalid=function(){var t=!this.$valid;return t&&!this.$validate&&(t=!this.$dirty),t},Jt.watch=function(t,e,n){var r=this;return'function'==typeof t&&(n=e,e=t,t=r.path),r.on('watch',t,e),n&&e.call(r,t,r.get(t),0),r},Jt.invalid=function(){return ut.invalid(this.path,this)},Jt.valid=function(t,e){var n=this;return void 0===t?n.$valid:n.$valid_disabled?n:(n.$valid=t,n.$validate=!1,n.$interaction(102),F('valid'),!e&&n.state&&n.state(1,1),n)},Jt.style=function(t){return lt.STYLE(t),this},Jt.change=function(t){return ut.change(this.path,void 0===t?!0:t,this),this},Jt.used=function(){return this.$interaction(100)},Jt.dirty=function(t,e){return void 0===t?this.$dirty:this.$dirty_disabled?this:(this.$dirty=t,this.$interaction(101),F('dirty'),!e&&this.state&&this.state(2,2),this)},Jt.reset=function(){return ut.reset(this.path,0,this),this},Jt.setDefault=function(t){return this.$default=function(){return t},this},Jt['default']=function(t){return ut['default'](this.path,0,this,t),this},Jt.remove=function(t){var e=this;return e.element.removeData(rt),e.element.find(et).attr(it,'true'),e.element.attr(it,'true'),e.$removed=!0,t||(F(),setTimeout2('$cleaner',Y,100)),!0},Jt.on=function(t,e,n,r){'function'==typeof e?(r=n,n=e,e=''):e=e.replace('.*','');var i=null;33===e.charCodeAt(0)&&(e=e.substring(1),i=e),mt[e]?mt[e][t]||(mt[e][t]=[]):(mt[e]={},mt[e][t]=[]);var a=this;return mt[e][t].push({fn:n,context:a,id:a._id,path:i}),r&&n.call(ut,e,P(e)),a},Jt.formatter=function(t){var e=this;if('function'==typeof t)return e.$formatter||(e.$formatter=[]),e.$formatter.push(t),e;var n=e.$formatter;if(n&&n.length)for(var r=0,i=n.length;i>r;r++)t=n[r].call(e,e.path,t,e.type);if(n=ut.$formatter,n&&n.length)for(var r=0,i=n.length;i>r;r++)t=n[r].call(e,e.path,t,e.type);return t},Jt.parser=function(t){var e=this;if('function'==typeof t)return e.$parser||(e.$parser=[]),e.$parser.push(t),e;var n=e.$parser;if(n&&n.length)for(var r=0,i=n.length;i>r;r++)t=n[r].call(e,e.path,t,e.type);if(n=ut.$parser,n&&n.length)for(var r=0,i=n.length;i>r;r++)t=n[r].call(e,e.path,t,e.type);return t},Jt.emit=function(){return ut.emit.apply(ut,arguments),this},Jt.evaluate=function(t,e,n){return e||(e=t,t=this.path),ut.evaluate(t,e,n)},Jt.get=function(t){return t||(t=this.path),t?P(t):void 0},Jt.set=function(t,e,n){return void 0===e&&(e=t,t=this.path),t&&ut.set(t,e,n),this},Jt.inc=function(t,e,n){return void 0===e&&(e=t,t=this.path),t&&ut.inc(t,e,n),this},Jt.extend=function(t,e,n){return void 0===e&&(e=t,t=this.path),t&&ut.extend(t,e,n),this},Jt.push=function(t,e,n){return void 0===e&&(e=t,t=this.path),t&&ut.push(t,e,n),this},z.prototype.compare=function(t,e){'string'==typeof e&&'-'!==e.substring(0,1)&&(e=lt.DATETIME.add('-'+e));var n=this[t];return 0===n?!1:n<e.getTime()},z.prototype.convert=function(t){var e=Date.now(),n={},r=1,i=this;switch(t.toLowerCase().substring(0,3)){case'min':case'mm':case'm':r=6e4;break;case'hou':case'hh':case'h':r=36e4;break;case'sec':case'ss':case's':r=1e3}return n.init=0===i.init?0:(e-i.init)/r>>0,n.manually=0===i.manually?0:(e-i.manually)/r>>0,n.input=0===i.input?0:(e-i.input)/r>>0,n['default']=0===i['default']?0:(e-i['default'])/r>>0,n.custom=0===i.custom?0:(e-i.custom)/r>>0,n.dirty=0===i.dirty?0:(e-i.dirty)/r>>0,n.valid=0===i.valid?0:(e-i.valid)/r>>0,n},lt.PROTOTYPECONTAINER=_t,lt.PROTOTYPEPROPERTY=Wt,lt.PROTOTYPEAPP=Xt,lt.PROTOTYPECOMPONENT=Jt,lt.PROTOTYPEUSAGE=z.prototype,lt.isMOBILE='ontouchstart'in lt||navigator.maxTouchPoints?!0:!1,lt.isROBOT=navigator.userAgent?/search|agent|bot|crawler|spider/i.test(navigator.userAgent):!0,lt.isSTANDALONE=navigator.standalone||lt.matchMedia('(display-mode: standalone)').matches,lt.setTimeout2=function(t,e,n,r,i){var a=':'+t;if(r>0){var o=a+':limit';if(Rt[o]>=r)return;return Rt[o]=(Rt[o]||0)+1,Rt[a]&&clearTimeout(Rt[a]),Rt[a]=setTimeout(function(t){Rt[o]=void 0,e&&e(t)},n,i)}return Rt[a]&&clearTimeout(Rt[a]),Rt[a]=setTimeout(e,n,i)},lt.clearTimeout2=function(t){var e=':'+t;return Rt[e]?(clearTimeout(Rt[e]),Rt[e]=void 0,Rt[e+':limit']&&(Rt[e+':limit']=void 0),!0):!1},lt.TRY=function(t,e){try{return t(),!0}catch(n){e&&e(n)}return!1},lt.COMPONENT_EXTEND=function(t,e){pt[t]||(pt[t]=[]),pt[t].push(e);for(var n=0,r=ut.components.length;r>n;n++){var i=ut.components[n];i.$removed&&t!==i.name||e.apply(i,i)}},lt.COMPONENT=function(t,e){var n={},r=function(r){var i=new B(t);return i.global=n,i.element=r,i.setPath(s(r,'path')||i._id,!0),e.call(i),i};ut.$components[t]&&v('Components: Overwriting component:',t),ut.$components[t]=r},lt.SINGLETON=function(t,e){return $t[t]||($t[t]=new Function('return '+(e||'{}'))())},lt.WIDTH=function(t){t||(t=$(lt));var e=t.width(),n=ut.defaults.devices;return e>=n.md.min&&e<=n.md.max?'md':e>=n.sm.min&&e<=n.sm.max?'sm':e>n.lg.min?'lg':e<=n.xs.max?'xs':''},lt.WORKFLOW=function(t,e){if(!e){if(!Nt)return NOOP;var n=Nt[t];return n instanceof Array?function(){for(var t=0,e=n.length;e>t;t++)n[t].apply(this,arguments)}:NOOP}Nt||(Nt={});var n=Nt[t];n?n.push(e):Nt[t]=[e]},lt.MEDIAQUERY=function(t,e,n){if('number'==typeof t)return yt.remove('id',t),!0;'function'==typeof e&&(n=e,e=null),t=t.toLowerCase();var r;if(-1!==t.indexOf(',')){var i=[];return t.split(',').forEach(function(t){t=t.trim(),t&&i.push(lt.MEDIAQUERY(t,e,n))}),i}var a=ut.defaults.devices;'md'===t?t='min-width:{0}px and max-width:{1}px'.format(a.md.min,a.md.max):'lg'===t?t='min-width:{0}px'.format(a.lg.min):'xs'===t?t='max-width:{0}px'.format(a.xs.max):'sm'===t&&(t='min-width:{0}px and max-width:{1}px'.format(a.sm.min,a.sm.max));var o=t.match(/(max-width|min-width|max-device-width|min-device-width|max-height|min-height|max-device-height|height|width):(\s)\d+(px|em|in)?/gi),s={},u=function(t){var e=parseInt(t.match(/\d+/),10);return t.match(/\d+(em)/)?16*e:t.match(/\d+(in)/)?.010416667*e>>0:e};if(o)for(var c=0,l=o.length;l>c;c++){var f=o[c],d=f.indexOf(':');switch(f.substring(0,d).toLowerCase().trim()){case'min-width':case'min-device-width':case'width':s.minW=u(f);break;case'max-width':case'max-device-width':s.maxW=u(f);break;case'min-height':case'min-device-height':case'height':s.minH=u(f);break;case'max-height':case'max-device-height':s.maxH=u(f)}}if(o=t.match(/orientation:(\s)(landscape|portrait)/gi))for(var c=0,l=o.length;l>c;c++){var f=o[c];s.orientation=-1!==f.toLowerCase().indexOf('portrait')?'portrait':'landscape'}return s.id=Lt++,s.fn=n,s.type=r,e&&(s.element=e),yt.push(s),s.id},lt.UPLOAD=ut.upload,lt.MIDDLEWARE=function(t,e,n,r){if(!(t instanceof Array))return void(wt[t]=e);if('function'!=typeof n){var i=n;n=e,e=i}var a={};t.waitFor(function(t,n){var i=wt[t];return i?void i.call(a,n,e,r):(!Et[t]&&v('Components: Middleware "{0}" not found.'.format(t)),Et[t]=!0,void n())},function(t){n&&n.call(a,void 0!==t?t:e,r)})},lt.FN=function(t){var e=t.indexOf('=>'),n=t.substring(0,e).trim(),r=t.substring(e+2).trim(),i=!1;n=n.replace(/\(|\)|\s/g,'').trim(),n&&(n=n.split(',')),123===r.charCodeAt(0)&&(i=!0,r=r.substring(1,r.length-1).trim());var a=(i?'':'return ')+r;switch(n.length){case 1:return new Function(n[0],a);case 2:return new Function(n[0],n[1],a);case 3:return new Function(n[0],n[1],n[2],a);case 4:return new Function(n[0],n[1],n[2],n[3],a);case 0:default:return new Function(a)}},lt.SETTER=function(t,e){for(var n=[],r=t===!0?3:2,i=r;i<arguments.length;i++)n.push(arguments[i]);return 3===r?(t=e,e=arguments[2],FIND(t,function(t){'function'==typeof t[e]?t[e].apply(t,n):t[e]=n[0]})):FIND(t,!0).forEach(function(t){'function'==typeof t[e]?t[e].apply(t,n):t[e]=n[0]}),lt.SETTER},lt.EXEC=function(t){for(var e=[],n=1;n<arguments.length;n++)e.push(arguments[n]);var r=t.charCodeAt(0);if(35===r)return OPERATION(t).apply(lt,e),EXEC;var i=t.indexOf('/');if(-1!==i){var a=CONTROLLER(t.substring(0,i)),o=t.substring(i+1);return a&&'function'==typeof a[o]&&a[o].apply(a,e),lt.EXEC}var o=P(t);return'function'==typeof o&&o.apply(lt,e),lt.EXEC},lt.MAKE=function(t,e,n){switch(typeof t){case'function':e=t,t={};break;case'string':var r=t,i=!0;return t=P(r),null==t&&(i=!1,t={}),e.call(t,t,r),!i||void 0!==n&&n!==!0?st.ready?L(r,t):ut.set(r,t,!0):ut.update(r,!0),t}return e.call(t,t,''),t},lt.CLONE=function(t){var e=typeof t;switch(e){case'number':case'string':case'boolean':return t}return null==t?t:t instanceof Date?new Date(t.getTime()):PARSE(JSON.stringify(t))},lt.STRINGIFY=function(t,e){return void 0===e&&(e=ut.defaults.jsoncompress),JSON.stringify(t,function(t,n){if(e===!0){var r=typeof n;if('string'===r)return n=n.trim(),n?n:void 0;if(n===!1||null==n)return void 0}return n})},lt.PARSE=function(t,e){void 0===e&&(e=ut.defaults.jsondate);try{return JSON.parse(t,function(t,n){return'string'==typeof n&&e&&n.isJSONDate()?new Date(n):n})}catch(n){return null}},lt.NOOP=function(){},lt.REWRITE=ut.rewrite,lt.SET=function(t,e,n,r){return'boolean'==typeof n?ut.set(t,e,n):!n||5>n?ut.set(t,e,n):(setTimeout(function(){ut.set(t,e,r)},n),ut)},lt.INC=function(t,e,n,r){return'boolean'==typeof n?ut.inc(t,e,n):!n||5>n?ut.inc(t,e,n):(setTimeout(function(){ut.inc(t,e,r)},n),ut)},lt.EXTEND=function(t,e,n,r){return'boolean'==typeof n?ut.extend(t,e,n):!n||5>n?ut.extend(t,e,n):(setTimeout(function(){ut.extend(t,e,r)},n),ut)},lt.PUSH=function(t,e,n,r){return'boolean'==typeof n?ut.push(t,e,n):!n||5>n?ut.push(t,e,n):(setTimeout(function(){ut.push(t,e,r)},n),ut)},lt.INVALID=ut.invalid,lt.RESET=ut.reset,lt.COOKIES=ut.cookies,lt.DEFAULT=function(t,e,n){return ut['default'](t,e,null,n)},lt.WATCH=function(t,e,n){return ON('watch',t,e,n)},lt.UPTODATE=function(t,e,n){'function'==typeof e&&(n=e,e='');var r=(new Date).add(t);ON('knockknock',function(){r>lt.DATETIME||(setTimeout(function(){e?lt.location.href=e:lt.location.reload(!0)},5e3),n&&n())})},lt.PING=function(t,e,n){if(null==navigator.onLine||navigator.onLine){if('function'==typeof e){var r=n;n=e,e=r}var i=t.indexOf(' '),a='GET';-1!==i&&(a=t.substring(0,i).toUpperCase(),t=t.substring(i).trim());var o={},s=T(t);return o.type=a,o.headers={'X-Ping':location.pathname},o.success=function(t){'string'==typeof n?H(n,t):n&&n(t)},o.error=function(e,r,i){r=r+': '+i,ut.emit('error',i,r,t),'function'==typeof n&&n(void 0,r,t)},setInterval(function(){$.ajax(s,o)},e||3e4)}},lt.VALIDATE=ut.validate,lt.CAN=ut.can,lt.DISABLED=ut.disabled,lt.AJAX=ut.AJAX,lt.AJAXCACHE=ut.AJAXCACHE,lt.AJAXCACHEREVIEW=ut.AJAXCACHEREVIEW,lt.GET=ut.get,lt.CACHE=ut.cache,lt.CACHEPATH=ut.cachepath,lt.NOTIFY=ut.notify,lt.NOTMODIFIED=function(t,e,n){void 0===e&&(e=P(t)),void 0===e&&(e=null),n&&(t=t.concat('#',n));var r=lt.HASH(lt.STRINGIFY(e,n)),i='notmodified.'+t;return ht[i]===r?!0:(ht[i]=r,!1)},lt.SCHEDULE=ut.schedule,lt.FIND=function(t,e,n,r){var i=!1;if('function'==typeof e)i=!0,r=e,e=void 0;else if('function'==typeof n){var a=r;i=!0,r=n,n=a}if(i)return void WAIT(function(){var r=FIND(t,e,n);return r instanceof Array?r.length>0:r?!0:!1},function(n){if(!n){var i=FIND(t,e);r.call(i?i:lt,i)}},500,n);var o,s;return!n&&(o='find.'+t+'.'+(e?0:1),s=ht[o])?s:46===t.charCodeAt(0)?(s=ut.findByPath(t.substring(1),e),n||(ht[o]=s),s):35===t.charCodeAt(0)?(s=ut.findById(t.substring(1),void 0,e),n||(ht[o]=s),s):(s=ut.findByName(t,void 0,e),n||(ht[o]=s),s)},lt.UPDATE=function(t,e,n){return'boolean'==typeof e?ut.update(t,e):e?void setTimeout(function(){ut.update(t,n)},e):ut.update(t,n)},lt.CHANGE=ut.change,lt.INJECT=lt.IMPORT=ut['import'],lt.SCHEMA=function(t,e){return ut.schema(t,e)},lt.OPERATION=function(t,e){return e?It[t]=e:e=It[35===t.charCodeAt(0)?t.substring(1):t],e},lt.ON=function(t,e,n,r){return ut.on(t,e,n,r)},lt.EMIT=ut.emit,lt.EVALUATE=ut.evaluate,lt.STYLE=function(t){Dt.push(t instanceof Array?t.join('\n'):t),setTimeout2('$style',function(){$('<style type="text/css">'+Dt.join('')+'</style>').appendTo('head'),Dt=[]},50)},lt.BLOCKED=function(t,e,n){return ut.blocked(t,e,n)},lt.HASH=function(t){if(!t)return 0;'string'!=typeof t&&(t=STRINGIFY(t));var e,n,r=0;if(!t.length)return r;var i=t.length;for(e=0;i>e;e++)n=t.charCodeAt(e),r=(r<<5)-r+n,r|=0;return r},lt.GUID=function(t){t||(t=10);for(var e=(t/24>>0)+1,n=[],r=0;e>r;r++)n.push(Math.random().toString(36).substring(2));return n.join('').substring(0,t)},lt.KEYPRESS=function(t,e,n){e||(e=300);var r=t.toString(),i=r.length-20;0>i&&(i=0);var a=n?n:lt.HASH(r.substring(0,20)+'X'+r.substring(i))+'_keypress';setTimeout2(a,t,e)},lt.WAIT=function(t,e,n,r){var i=(1e4*Math.random()>>0).toString(16),a=r>0?i+'_timeout':0;if('number'==typeof e){var o=n;n=e,e=o}var s='string'==typeof t,u=!1;if(s){var c=P(t);c&&(u=!0)}else t()&&(u=!0);return u?void e(null,function(i){setTimeout(function(){WATCH(t,e,n,r)},i||1)}):(a&&(Ct[a]=setTimeout(function(){clearInterval(Ct[i]),delete Ct[a],delete Ct[i],e(new Error('Timeout.'))},r)),void(Ct[i]=setInterval(function(){if(s){var r=P(t);if(null==r)return}else if(!t())return;clearInterval(Ct[i]),delete Ct[i],a&&(clearTimeout(Ct[a]),delete Ct[a]),e&&e(null,function(r){setTimeout(function(){WATCH(t,e,n)},r||1)})},n||500)))},lt.COMPILE=function(t){return d(t)},lt.CONTROLLER=function(){var t=arguments[arguments.length-1];if('function'!=typeof t)return St[arguments[0]];var e={};return e.name=e.path=arguments[0],St[e.name]=e,e.get=function(t){return ut.get(e.path+(t?'.'+t:''))},e.set=function(t,n,r){return 1===arguments.length&&(n=t,t=void 0),ut.set(e.path+(t?'.'+t:''),n,r),e},e.destroy=function(){return e.element.remove(),delete St[e.name],void setTimeout(Y,500)},e.$init=function(n,r){return e.$init=void 0,n&&(e.path=n),e.element=r,t.call(e,e,n,r),e}},lt.VIRTUALIZE=function(t,e){return!(t instanceof jQuery)&&(t=$(t)),new J(t,e)},COMPONENT('',function(){var t=this,e=t.element.get(0).tagName;if('INPUT'!==e&&'SELECT'!==e&&'TEXTAREA'!==e)t.readonly(),t.setter=function(e){e=t.formatter(e,!0),t.element.html(e)};else{var n='data-jc-bind';!t.element.attr(n)&&t.element.attr(n,'1'),t.element.attr('required')&&(t.validate=function(t,e){return e?!0:t?!0:!1}),t.element.$com=t}}),Array.prototype.waitFor=function(t,e){void 0===t.index&&(t.index=0);var n=t.index,r=this,i=r[t.index++];return i?(t.call(r,i,function(n){t.value=n,r.waitFor(t,e)},n),r):(e&&e(t.value),delete t.value,r)},Array.prototype.compare=function(t,e,n){for(var r=this,i=[],a=[],o=[],s=r.length,u=e.length,c=0;s>c;c++){for(var l=r[c],f=!1,d=0;u>d;d++){var p=e[d];if(p[t]===l[t]){STRINGIFY(l,n)!==STRINGIFY(p,n)&&i.push({oldIndex:c,newIndex:d,oldItem:l,newItem:p}),f=!0;break}}!f&&o.push({oldIndex:c,newIndex:d,oldItem:l,newItem:p})}for(var c=0;u>c;c++){for(var l=e[c],f=!0,d=0;s>d;d++){var p=r[d];if(p[t]===l[t]){f=!1;break}}f&&a.push({oldIndex:null,newIndex:c,oldItem:null,newItem:l})}var h=o.length/s*100,v=i.length/s*100;return{change:a.length||o.length||i.length?!0:!1,redraw:h>60||v>60,append:a,remove:o,update:i}},Array.prototype.async=function(t,e){if('function'==typeof t){var n=e;e=t,t=n}t||(t={});var r=this,i=0,a=function(){var n=r[i++];return n?void n.call(t,a,i-1):e&&e.call(t)};return a(),this},Array.prototype.ticks=function(t,e){var n=this,r=n.length;if(t>r)return n;var i=Math.round(r/t),a=[],o=0,s=0;if(e)for(var u=0;r>u&&(s++%i===0&&(o++,a.push(n[u])),o!==t);u++);else{for(var u=r-1;u>-1&&(s++%i===0&&(o++,a.push(n[u])),o!==t);u--);a.reverse()}return a},Array.prototype.take=function(t){for(var e=[],n=this,r=n.length,i=0;r>i;i++)if(e.push(n[i]),e.length>=t)return e;return e},Array.prototype.skip=function(t){for(var e=[],n=this,r=n.length,i=0;r>i;i++)i>=t&&e.push(n[i]);return e},String.prototype.isJSONDate=function(){var t=this,e=t.length-1;return e>22&&30>e&&90===t.charCodeAt(e)&&84===t.charCodeAt(10)&&45===t.charCodeAt(4)&&58===t.charCodeAt(13)&&58===t.charCodeAt(16)},String.prototype.parseExpire=function(){var t=this.split(' '),e=parseInt(t[0]);if(isNaN(e))return 0;var n=36e5;switch(t[1].trim().replace(/\./g,'')){case'minutes':case'minute':case'min':case'mm':case'm':return 6e4*e;case'hours':case'hour':case'HH':case'hh':case'h':case'H':return n*e;case'seconds':case'second':case'sec':case'ss':case's':return 1e3*e;case'days':case'day':case'DD':case'dd':case'd':return 24*n*e;case'months':case'month':case'MM':case'M':return 24*n*28*e;case'weeks':case'week':case'W':case'w':return 24*n*7*e;case'years':case'year':case'yyyy':case'yy':case'y':return 24*n*365*e;default:return 0}},String.prototype.removeDiacritics=function(){for(var t='',e=0,n=this.length;n>e;e++){var r=this[e],i=r.charCodeAt(0),a=!1,o=ot[i];void 0===o&&(i=r.toLowerCase().charCodeAt(0),o=ot[i],a=!0),void 0!==o?(r=o,t+=a?r.toUpperCase():r):t+=r}return t},String.prototype.toSearch=function(){for(var t=this.replace(/[^a-zA-Z--\d\s:]/g,'').trim().toLowerCase().removeDiacritics(),e=[],n='',r=0,i=t.length;i>r;r++){var a=t.substring(r,r+1);'y'===a&&(a='i'),a!==n&&(n=a,e.push(a))}return e.join('')},String.prototype.slug=function(t){t=t||60;for(var e=this.trim().toLowerCase().removeDiacritics(),n='',r=e.length,i=0;r>i;i++){var a=e.substring(i,i+1),o=e.charCodeAt(i);if(n.length>=t)break;o>31&&48>o?'-'!==n.substring(n.length-1,n.length)&&(n+='-'):o>47&&58>o?n+=a:o>94&&123>o&&(n+=a)}var s=n.length-1;return'-'===n[s]?n.substring(0,s):n},String.prototype.isEmail=function(){var t=this;return t.length<=4?!1:ut.validators.email.test(t)},String.prototype.isPhone=function(){var t=this;return t.length<6?!1:ut.validators.phone.test(t)},String.prototype.isURL=function(){var t=this;return t.length<=7?!1:ut.validators.url.test(t)},String.prototype.parseInt=function(t){var e=this.trim(),n=e.match(ut.regexp['int']);return n?(n=+n[0],isNaN(n)?t||0:n):t||0},String.prototype.parseFloat=function(t){var e=this.trim(),n=e.match(ut.regexp['float']);return n?(n=n[0],-1!==n.indexOf(',')&&(n=n.replace(',','.')),n=+n,isNaN(n)?t||0:n):t||0},Array.prototype.trim=function(){for(var t=this,e=[],n=0,r=t.length;r>n;n++)'string'==typeof t[n]&&(t[n]=t[n].trim()),t[n]&&e.push(t[n]);return e},Array.prototype.findIndex=function(t,e){for(var n=this,r='function'==typeof t,i=void 0!==e,a=0,o=n.length;o>a;a++)if(r){if(t.call(n,n[a],a))return a}else if(i){if(n[a][t]===e)return a}else if(n[a]===t)return a;return-1},Array.prototype.findItem=function(t,e){var n=this.findIndex(t,e);return-1!==n?this[n]:void 0},Array.prototype.remove=function(t,e){for(var n=this,r=[],i='function'==typeof t,a=void 0!==e,o=0,s=n.length;s>o;o++)i?!t.call(n,n[o],o)&&r.push(n[o]):a?n[o][t]!==e&&r.push(n[o]):n[o]!==t&&r.push(n[o]);return r},Date.prototype.parseDate=function(){return this},Date.prototype.add=function(t,e){if(void 0===e){var n=t.split(' ');t=n[1],e=parseInt(n[0])}var r=this,i=new Date(r.getTime());switch(t.substring(0,3)){case's':case'ss':case'sec':return i.setSeconds(i.getSeconds()+e),i;case'm':case'mm':case'min':return i.setMinutes(i.getMinutes()+e),i;case'h':case'hh':case'hou':return i.setHours(i.getHours()+e),
i;case'd':case'dd':case'day':return i.setDate(i.getDate()+e),i;case'w':case'ww':case'wee':return i.setDate(i.getDate()+7*e),i;case'M':case'MM':case'mon':return i.setMonth(i.getMonth()+e),i;case'y':case'yy':case'yyy':case'yea':return i.setFullYear(i.getFullYear()+e),i}return i},Date.prototype.format=function(t){var e=this,n=!1;if(t&&33===t.charCodeAt(0)&&(n=!0,t=t.substring(1)),void 0===t||null===t||''===t)return e.getFullYear()+'-'+(e.getMonth()+1).toString().padLeft(2,'0')+'-'+e.getDate().toString().padLeft(2,'0')+'T'+e.getHours().toString().padLeft(2,'0')+':'+e.getMinutes().toString().padLeft(2,'0')+':'+e.getSeconds().toString().padLeft(2,'0')+'.'+e.getMilliseconds().padLeft(3,'0').toString()+'Z';var r=e.getHours();return n&&r>=12&&(r-=12),t.replace(ut.regexp.date,function(t){switch(t){case'yyyy':return e.getFullYear();case'yy':return e.getYear().toString().substring(1);case'MM':return(e.getMonth()+1).toString().padLeft(2,'0');case'M':return e.getMonth()+1;case'dd':return e.getDate().toString().padLeft(2,'0');case'd':return e.getDate();case'HH':case'hh':return r.toString().padLeft(2,'0');case'H':case'h':return e.getHours();case'mm':return e.getMinutes().toString().padLeft(2,'0');case'm':return e.getMinutes();case'ss':return e.getSeconds().toString().padLeft(2,'0');case's':return e.getSeconds();case'w':case'ww':var n=new Date(+e);return n.setHours(0,0,0),n.setDate(n.getDate()+4-(n.getDay()||7)),n=Math.ceil(((n-new Date(n.getFullYear(),0,1))/864e5+1)/7),'ww'===t?n.toString().padLeft(2,'0'):n;case'a':return e.getHours()>=12?'PM':'AM'}})},Number.prototype.pluralize=function(t,e,n,r){var i=this,a='';return a=0==i?t||'':1==i?e||'':i>1&&5>i?n||'':r,-1===a.indexOf('#')?a:a.replace(ut.regexp.pluralize,function(t){return'##'===t?i.format():i.toString()})},Number.prototype.format=function(t,e,n){var r=this,i=r.toString(),a='',o='',s='-'===i.substring(0,1)?'-':'';s&&(i=i.substring(1));var u=i.indexOf('.');if('string'==typeof t){var c=e;e=t,t=c}void 0===e&&(e=' '),-1!==u&&(a=i.substring(u+1),i=i.substring(0,u)),u=-1;for(var l=i.length-1;l>=0;l--)u++,u>0&&u%3===0&&(o=e+o),o=i[l]+o;return(t||a.length)&&(a=a.length>t?a.substring(0,t||0):a.padRight(t||0,'0')),a.length&&void 0===n&&(n='.'===e?',':'.'),s+o+(a.length?n+a:'')},String.prototype.padLeft=function(t,e){var n=this.toString();return Array(Math.max(0,t-n.length+1)).join(e||' ')+n},String.prototype.padRight=function(t,e){var n=this.toString();return n+Array(Math.max(0,t-n.length+1)).join(e||' ')},Number.prototype.padLeft=function(t,e){return this.toString().padLeft(t,e||'0')},Number.prototype.padRight=function(t,e){return this.toString().padRight(t,e||'0')},Number.prototype.add=Number.prototype.inc=function(t,e){if(null==t)return this;if('number'==typeof t)return this+t;var n=t.charCodeAt(0),r=!1;(48>n||n>57)&&(r=!0,t=t.substring(1));var i,a=t.length;if('%'===t[a-1]){if(t=t.substring(0,a-1),r){var o=t.parseFloat();switch(n){case 42:i=this*(this/100)*o;break;case 43:i=this+this/100*o;break;case 45:i=this-this/100*o;break;case 47:i=this/(this/100*o)}return void 0!==e?i.floor(e):i}return i=this/100*t.parseFloat(),void 0!==e?i.floor(e):i}switch(i=t.parseFloat(),n){case 42:i=this*i;break;case 43:i=this+i;break;case 45:i=this-i;break;case 47:i=this/i;break;default:i=this}return void 0!==e?i.floor(e):i},Number.prototype.floor=function(t){return Math.floor(this*Math.pow(10,t))/Math.pow(10,t)},String.prototype.format=function(){var t=arguments;return this.replace(ut.regexp.format,function(e){var n=t[+e.substring(1,e.length-1)];return null==n?'':n instanceof Array?n.join(''):n})},String.prototype.parseDate=function(){var t=this.trim();if(!t)return null;var e=t.charCodeAt(t.length-1);if(41===e)return new Date(t);if(90===e)return new Date(Date.parse(t));var n=t.split(-1===t.indexOf(' ')?'T':' '),r=n[0].indexOf(':'),i=n[0].length;if(-1!==r){var a=n[1];n[1]=n[0],n[0]=a}void 0===n[0]&&(n[0]='');for(var o=void 0===n[1]?!0:0===n[1].length,s=0;i>s;s++){var u=n[0].charCodeAt(s);if(!(u>47&&58>u||45===u||46===u)&&o)return new Date(t)}void 0===n[1]&&(n[1]='00:00:00');var c=-1===n[0].indexOf('-'),l=(n[0]||'').split(c?'.':'-'),f=(n[1]||'').split(':'),d=[];if(l.length<4&&f.length<2)return new Date(t);r=(f[2]||'').indexOf('.'),-1!==r?(f[3]=f[2].substring(r+1),f[2]=f[2].substring(0,r)):f[3]='0',d.push(+l[c?2:0]),d.push(+l[1]),d.push(+l[c?0:2]),d.push(+f[0]),d.push(+f[1]),d.push(+f[2]),d.push(+f[3]);for(var p=lt.DATETIME=new Date,s=0,i=d.length;i>s;s++){isNaN(d[s])&&(d[s]=0);var h=d[s];if(0===h)switch(s){case 0:0>=h&&(d[s]=p.getFullYear());break;case 1:0>=h&&(d[s]=p.getMonth()+1);break;case 2:0>=h&&(d[s]=p.getDate())}}return new Date(d[0],d[1]-1,d[2],d[3],d[4],d[5])},Array.prototype.last=function(t){var e=this[this.length-1];return void 0===e?t:e},Array.prototype.quicksort=function(t,e,n){var r=this.length;if(!r||1===r)return this;'boolean'==typeof t&&(e=t,t=void 0),void 0===n&&(n=3),void 0===e&&(e=!0);var i=this,a=0,o=t?i[0][t]:i[0];switch(typeof o){case'string':a=o.isJSONDate()?4:1;break;case'number':a=2;break;case'boolean':a=3;break;default:if(!(o instanceof Date))return i;a=4}return i.sort(function(r,i){var o=t?r[t]:r,s=t?i[t]:i;if(1===a)return o&&s?e?o.substring(0,n).removeDiacritics().localeCompare(s.substring(0,n).removeDiacritics()):s.substring(0,n).removeDiacritics().localeCompare(o.substring(0,n).removeDiacritics()):0;if(2===a)return o>s?e?1:-1:s>o?e?-1:1:0;if(3===a)return o===!0&&s===!1?e?1:-1:o===!1&&s===!0?e?-1:1:0;if(4===a){if(!o||!s)return 0;o.getTime||(o=new Date(o)),s.getTime||(s=new Date(s));var u=o.getTime(),c=s.getTime();return u>c?e?1:-1:c>u?e?-1:1:0}return 0}),i},Array.prototype.attr=function(t,e){if(2===arguments.length){if(null==e)return this}else void 0===e&&(e=t.toString());return this.push(t+'="'+e.toString().replace(/[<>&"]/g,function(t){switch(t){case'&':return'&amp;';case'<':return'&lt;';case'>':return'&gt;';case'"':return'&quot;'}return t})+'"'),this},Array.prototype.scalar=function(t,e,n){for(var r=n,i=!1,a='avg'===t||'average'===t,o='distinct'===t,s=0,u=this.length;u>s;s++){var c=e?this[s][e]:this[s];if('string'==typeof c&&(c=c.parseFloat()),c instanceof Date&&(i=!0,c=c.getTime()),o)r||(r=[]),-1===r.indexOf(c)&&r.push(c);else if('median'!==t)if('sum'===t||a)r?r+=c:r=c;else switch('range'!==t?r||(r=c):r||(r=new Array(2),r[0]=c,r[1]=c),t){case'range':r[0]=Math.min(r[0],c),r[1]=Math.max(r[1],c);break;case'min':r=Math.min(r,c);break;case'max':r=Math.max(r,c)}else r||(r=[]),r.push(c)}if(o)return r;if(a)return r/=this.length,i?new Date(r):r;if('median'===t){r.sort(function(t,e){return t-e});var l=Math.floor(r.length/2);r=r.length%2?r[l]:(r[l-1]+r[l])/2}if(i){if('number'==typeof r)return new Date(r);r[0]=new Date(r[0]),r[1]=new Date(r[1])}return r},WAIT(function(){return lt.jQuery?!0:!1},function(){setInterval(function(){gt={},Y()},3e5),Ht=0,setInterval(function(){if(bt.length){Ht++;var t=new Date;lt.DATETIME=t;for(var e=0,n=bt.length;n>e;e++){var r=bt[e];if('m'===r.type){if(Ht%30!==0)continue}else if('h'===r.type&&Ht%900!==0)continue;var i=t.add(r.expire);FIND(r.selector,!0).forEach(function(t){t&&t.usage.compare(r.name,i)&&r.callback(t)})}}},3500),$.fn.asvg=function(t){if(-1===t.indexOf('<')){var e=document.createElementNS('http://www.w3.org/2000/svg',t);return this.append(e),$(e)}var n=document.createElementNS('http://www.w3.org/1999/xhtml','div');n.innerHTML='<svg xmlns="http://www.w3.org/2000/svg">'+t+'</svg>';for(var r=document.createDocumentFragment();n.firstChild.firstChild;)r.appendChild(n.firstChild.firstChild);return r=$(r),this.append(r),r},$.fn.psvg=function(t){if(-1===t.indexOf('<')){var e=document.createElementNS('http://www.w3.org/2000/svg',t);return this.prepend(e),$(e)}var n=document.createElementNS('http://www.w3.org/1999/xhtml','div');n.innerHTML='<svg xmlns="http://www.w3.org/2000/svg">'+t+'</svg>';for(var r=document.createDocumentFragment();n.firstChild.firstChild;)r.appendChild(n.firstChild.firstChild);return r=$(r),this.prepend(r),r},$.fn.component=function(){return this.data(rt)},$.fn.components=function(t){var e,n=this.find(et);return n.each(function(n){var r=$(this).data(et);if(r)if(r instanceof Array)r.forEach(function(r){if(r&&r.$ready&&!r.$removed){if(t)return t.call(r,n);e||(e=[]),e.push(r)}});else if(r&&r.$ready&&!r.$removed){if(t)return t.call(r,n);e||(e=[]),e.push(r)}}),t?n:e},$.components=ut,setInterval(function(){lt.DATETIME=new Date;for(var t=ut.components,e=0,n=t.length;n>e;e++)t[e].knockknock&&t[e].knockknock(Pt);t=ut.apps;for(var e=0,n=t.length;n>e;e++)t[e].knockknock&&t[e].knockknock(Pt),t[e].emit('knockknock',Pt);ut.emit('knockknock',Pt++)},6e4),$(document).ready(function(){jt&&(clearTimeout(jt),f()),$(lt).on('resize',e),$(lt).on('orientationchange',e),e(),$(document).on('input change keypress keydown blur',at,function(t){var e=this;if('input'===t.type&&'range'!==e.type||'keypress'===t.type)return!('TEXTAREA'!==e.tagName&&13===t.keyCode);var n='checkbox'===e.type||'radio'===e.type||'range'===e.type;if(!('focusout'===t.type&&n||'change'===t.type&&!n&&'SELECT'!==e.tagName||!e.$com||e.$com.$removed)&&e.$com.getter){var i=t.keyCode;if(!((t.metaKey||9===i||i>15&&21>i||i>36&&41>i)&&86!==i&&88!==i||8===t.keyCode&&!e.value)){if(e.$skip&&'focusout'===t.type)return void r(e,e.$value,t);var a,o=e.$value;if(e.$value=null,'checkbox'===e.type||'radio'===e.type){if('keydown'===t.type)return;var a=e.checked;return e.$com.dirty(!1,!0),e.$com.getter(a,2),void(e.$com.$skip=!1)}if('SELECT'===e.tagName){if('keydown'===t.type||-1===e.selectedIndex)return;var u=e[e.selectedIndex];a=u.value;var c=!1;return e.$com.$dirty&&(c=!0),e.$com.dirty(!1,!0),e.$com.getter(a,2,c,o,'focusout'===t.type),void(e.$com.$skip=!1)}if(void 0===e.$delay&&(e.$delay=parseInt(s(e,'keypress-delay')||'0')),void 0===e.$only&&(e.$only='true'===s(e,'keypress-only')),(!e.$only||'focusout'!==t.type&&'change'!==t.type)&&('keydown'!==t.type||void 0!==t.keyCode&&9!==t.keyCode)){if(t.keyCode<41&&8!==t.keyCode&&32!==t.keyCode){if(13!==t.keyCode)return;if('TEXTAREA'!==t.tagName)return e.$value=e.value,clearTimeout2('M$timeout'),void r(e,o,t)}if(void 0===e.$nokeypress){var l=s(e,'keypress');e.$nokeypress=l?'false'===l:ut.defaults.keypress===!1}var f=e.$delay;if(e.$nokeypress){if('keydown'===t.type||'focusout'===t.type)return;f||(f=1)}else f||(f=ut.defaults.delay);'focusout'===t.type&&(f=0),setTimeout2('M$timeout',function(){r(e,o,t)},f)}}}}),setTimeout(d,2)})},100),ut.$parser.push(function(t,e,n){if('number'===n||'currency'===n||'float'===n){'string'==typeof e&&(e=e.replace(Z,'').replace(K,'.'));var r=parseFloat(e);return isNaN(r)?null:r}return e})}();

/*
 * ===========================================================================================
 * MERGED: /Users/bruce/Dev/study/totaljs/messanger/public/js/ui.js
 * ===========================================================================================
 */

COMPONENT('searchbox',function(){var self=this;var icon;self.noValidate();self.make=function(){self.classes('search');self.html('<span><i class="fa fa-search"></i></span><div><input type="text" placeholder="{0}" data-jc-bind=""{1} /></div>'.format(self.attr('data-placeholder')||'',self.attr('data-enter')==='true'?' data-jc-keypress="false"':''));icon=self.find('.fa');self.event('click','.fa-times',function(){self.set('')})};self.getter2=self.setter2=function(value){icon.toggleClass('fa-search',value?false:true).toggleClass('fa-times',value?true:false)}});COMPONENT('click',function(){var self=this;self.readonly();self.click=function(){var value=self.attr('data-value');if(typeof(value)==='string')self.set(self.parser(value));else self.get(self.attr('data-jc-path'))(self)};self.make=function(){self.event('click',self.click);var enter=self.attr('data-enter');enter&& $(enter).on('keydown','input',function(e){e.keyCode===13&&setTimeout(function(){!self.element.get(0).disabled&&self.click()},100)})}});COMPONENT('exec',function(){var self=this;self.readonly();self.blind();self.make=function(){self.event('click',self.attr('data-selector')||'.exec',function(){var el= $(this);var attr=el.attr('data-exec');var path=el.attr('data-path');attr&&EXEC(attr,el);path&&SET(path,new Function('return '+el.attr('data-value'))())})}});COMPONENT('message',function(){var self=this;var is=false;var visible=false;var timer;self.readonly();self.singleton();self.make=function(){self.element.addClass('ui-message hidden');self.element.on('click','button',function(){self.hide()});$(window).on('keyup',function(e){visible&&e.keyCode===27&&self.hide()})};self.warning=function(message,icon,fn){if(typeof(icon)==='function'){fn=icon;icon=undefined}self.callback=fn;self.content('ui-message-warning',message,icon||'fa-warning')};self.info=function(message,icon,fn){if(typeof(icon)==='function'){fn=icon;icon=undefined}self.callback=fn;self.content('ui-message-info',message,icon||'fa-check-circle')};self.success=function(message,icon,fn){if(typeof(icon)==='function'){fn=icon;icon=undefined}self.callback=fn;self.content('ui-message-success',message,icon||'fa-check-circle')};self.hide=function(){self.callback&&self.callback();self.element.removeClass('ui-message-visible');timer&&clearTimeout(timer);timer=setTimeout(function(){visible=false;self.element.addClass('hidden')},1000)};self.content=function(cls,text,icon){!is&&self.html('<div><div class="ui-message-body"><div class="text"></div><hr /><button>'+(self.attr('data-button')||'Close')+'</button></div></div>');timer&&clearTimeout(timer);visible=true;self.element.find('.ui-message-body').removeClass().addClass('ui-message-body '+cls);self.element.find('.fa').removeClass().addClass('fa '+icon);self.element.find('.text').html(text);self.element.removeClass('hidden');setTimeout(function(){self.element.addClass('ui-message-visible')},5)}});COMPONENT('validation',function(){var self=this;var path;var elements;self.readonly();self.make=function(){elements=self.find(self.attr('data-selector')||'button');elements.prop({disabled:true});self.evaluate=self.attr('data-if');path=self.path.replace(/\.\*$/,'');self.watch(self.path,self.state,true)};self.state=function(){var disabled=DISABLED(path);if(!disabled&&self.evaluate)disabled=!EVALUATE(self.path,self.evaluate);elements.prop({disabled:disabled})}});COMPONENT('checkbox',function(){var self=this;var input;var isRequired=self.attr('data-required')==='true';self.validate=function(value){var type=typeof(value);if(input.prop('disabled')||!isRequired)return true;value=type==='undefined'||type==='object'?'':value.toString();return value==='true'||value==='on'};self.required=function(value){self.find('span').toggleClass('ui-checkbox-label-required',value===true);isRequired=value;return self};!isRequired&&self.noValid();self.make=function(){self.classes('ui-checkbox');self.html('<div><i class="fa fa-check"></i></div><span{1}>{0}</span>'.format(self.html(),isRequired?' class="ui-checkbox-label-required"':''));self.event('click',function(){self.dirty(false);self.getter(!self.get(),2,true)})};self.setter=function(value){self.toggle('ui-checkbox-checked',value?true:false)}});COMPONENT('dropdown',function(){var self=this;var isRequired=self.attr('data-required')==='true';var select;var container;self.validate=function(value){if(select.prop('disabled')||!isRequired)return true;var type=typeof(value);if(type==='undefined'||type==='object')value='';else value=value.toString();EMIT('reflow',self.name);switch(self.type){case'currency':case'number':return value>0}return value.length>0};!isRequired&&self.noValid();self.required=function(value){self.find('.ui-dropdown-label').toggleClass('ui-dropdown-label-required',value);self.noValid(!value);isRequired=value;!value&&self.state(1,1)};self.render=function(arr){var builder=[];var value=self.get();var template='<option value="{0}"{1}>{2}</option>';var propText=self.attr('data-source-text')||'name';var propValue=self.attr('data-source-value')||'id';var emptyText=self.attr('data-empty');emptyText!==undefined&&builder.push('<option value="">{0}</option>'.format(emptyText));for(var i=0,length=arr.length;i<length;i++){var item=arr[i];if(item.length)builder.push(template.format(item,value===item?' selected="selected"':'',item));else builder.push(template.format(item[propValue],value===item[propValue]?' selected="selected"':'',item[propText]))}select.html(builder.join(''))};self.make=function(){var options=[];(self.attr('data-options')||'').split(';').forEach(function(item){item=item.split('|');options.push('<option value="{0}">{1}</option>'.format(item[1]===undefined?item[0]:item[1],item[0]))});self.classes('ui-dropdown-container');var label=self.html();var html='<div class="ui-dropdown"><span class="fa fa-sort"></span><select data-jc-bind="">{0}</select></div>'.format(options.join(''));var builder=[];if(label.length){var icon=self.attr('data-icon');builder.push('<div class="ui-dropdown-label{0}">{1}{2}:</div>'.format(isRequired?' ui-dropdown-label-required':'',icon?'<span class="fa {0}"></span> '.format(icon):'',label));builder.push('<div class="ui-dropdown-values">{0}</div>'.format(html));self.html(builder.join(''))}else self.html(html).addClass('ui-dropdown-values');select=self.find('select');container=self.find('.ui-dropdown');var ds=self.attr('data-source');if(!ds)return;var prerender=function(){var value=self.get(self.attr('data-source'));!NOTMODIFIED(self.id,value)&&self.render(value||EMPTYARRAY)};self.watch(ds,prerender,true)};self.state=function(type){if(!type)return;var invalid=self.isInvalid();if(invalid===self.$oldstate)return;self.$oldstate=invalid;container.toggleClass('ui-dropdown-invalid',invalid)}});COMPONENT('textbox',function(){var self=this;var isRequired=self.attr('data-required')==='true';var validation=self.attr('data-validate');var input;var container;self.validate=function(value){if(input.prop('disabled')||!isRequired)return true;var type=typeof(value);if(type==='undefined'||type==='object')value='';else value=value.toString();EMIT('reflow',self.name);switch(self.type){case'email':return value.isEmail();case'url':return value.isURL();case'currency':case'number':return value>0}return validation?self.evaluate(value,validation,true)?true:false:value.length>0};!isRequired&&self.noValid();self.required=function(value){self.find('.ui-textbox-label').toggleClass('ui-textbox-label-required',value);self.noValid(!value);isRequired=value;!value&&self.state(1,1)};self.make=function(){var attrs=[];var builder=[];var tmp;attrs.attr('type',self.type==='password'?self.type:'text');attrs.attr('placeholder',self.attr('data-placeholder'));attrs.attr('maxlength',self.attr('data-maxlength'));attrs.attr('data-jc-keypress',self.attr('data-jc-keypress'));attrs.attr('data-jc-keypress-delay',self.attr('data-jc-keypress-delay'));attrs.attr('data-jc-bind','');attrs.attr('name',self.path);tmp=self.attr('data-align');tmp&&attrs.attr('class','ui-'+tmp);self.attr('data-autofocus')==='true'&&attrs.attr('autofocus');var content=self.html();var icon=self.attr('data-icon');var icon2=self.attr('data-control-icon');var increment=self.attr('data-increment')==='true';builder.push('<input {0} />'.format(attrs.join(' ')));if(!icon2&&self.type==='date')icon2='fa-calendar';else if(self.type==='search'){icon2='fa-search ui-textbox-control-icon';self.event('click','.ui-textbox-control-icon',function(){self.$stateremoved=false;$(this).removeClass('fa-times').addClass('fa-search');self.set('')});self.getter2=function(value){if(self.$stateremoved&&!value)return;self.$stateremoved=value?false:true;self.find('.ui-textbox-control-icon').toggleClass('fa-times',value?true:false).toggleClass('fa-search',value?false:true)}}icon2&&builder.push('<div><span class="fa {0}"></span></div>'.format(icon2));increment&&!icon2&&builder.push('<div><span class="fa fa-caret-up"></span><span class="fa fa-caret-down"></span></div>');increment&&self.event('click','.fa-caret-up,.fa-caret-down',function(){var el= $(this);var inc=-1;if(el.hasClass('fa-caret-up'))inc=1;self.change(true);self.inc(inc)});self.type==='date'&&self.event('click','.fa-calendar',function(e){e.preventDefault();window.$calendar&&window.$calendar.toggle($(this).parent().parent(),self.find('input').val(),function(date){self.set(date)})});if(!content.length){self.classes('ui-textbox ui-textbox-container');self.html(builder.join(''));input=self.find('input');container=self.find('.ui-textbox');return}var html=builder.join('');builder=[];builder.push('<div class="ui-textbox-label{0}">'.format(isRequired?' ui-textbox-label-required':''));icon&&builder.push('<span class="fa {0}"></span> '.format(icon));builder.push(content);builder.push(':</div><div class="ui-textbox">{0}</div>'.format(html));self.html(builder.join(''));self.classes('ui-textbox-container');input=self.find('input');container=self.find('.ui-textbox')};self.state=function(type){if(!type)return;var invalid=self.isInvalid();if(invalid===self.$oldstate)return;self.$oldstate=invalid;container.toggleClass('ui-textbox-invalid',invalid)}});COMPONENT('repeater',function(){var self=this;var recompile=false;self.readonly();self.make=function(){var element=self.find('script');if(!element.length){element=self.element;self.element=self.element.parent()}var html=element.html();element.remove();self.template=Tangular.compile(html);recompile=html.indexOf('data-jc="')!==-1};self.setter=function(value){if(!value||!value.length){self.empty();return}var builder=[];for(var i=0,length=value.length;i<length;i++){var item=value[i];item.index=i;builder.push(self.template(item).replace(/\$index/g,i.toString()));}self.html(builder);recompile&&COMPILE()}});COMPONENT('error',function(){var self=this;var element;self.readonly();self.make=function(){self.append('<ul class="ui-error hidden"></ul>');element=self.find('ul')};self.setter=function(value){if(!(value instanceof Array)||!value.length){element.addClass('hidden');return}var builder=[];for(var i=0,length=value.length;i<length;i++)builder.push('<li><span class="fa fa-times-circle"></span> '+value[i].error+'</li>');element.empty();element.append(builder.join(''));element.removeClass('hidden')}});COMPONENT('template',function(){var self=this;self.readonly();self.make=function(template){if(template){self.template=Tangular.compile(template);return}var script=self.find('script');if(!script.length){script=self.element;self.element=self.element.parent()}self.template=Tangular.compile(script.html());script.remove()};self.setter=function(value){if(NOTMODIFIED(self.id,value))return;if(!value)return self.classes('hidden');KEYPRESS(function(){self.html(self.template(value)).removeClass('hidden')},100,self.id)}});COMPONENT('page',function(){var self=this;var isProcessed=false;var isProcessing=false;self.readonly();self.hide=function(){self.set('')};self.setter=function(value){if(isProcessing)return;var el=self.element;var is=el.attr('data-if')==value;var reload=self.attr('data-reload');if(isProcessed||!is){el.toggleClass('hidden',!is);is&&reload&&self.get(reload)();self.release(!is);return}SETTER('loading','show');isProcessing=true;IMPORT(el.attr('data-template'),el,function(){isProcessing=false;var init=el.attr('data-init');if(init){var fn=GET(init||'');typeof(fn)==='function'&&fn(self)}reload&&self.get(reload)();isProcessed=true;setTimeout(function(){el.toggleClass('hidden',!is)},200);SETTER('loading','hide',1000)})}});COMPONENT('form',function(){var self=this;var autocenter;if(!MAN.$$form){window.$$form_level=window.$$form_level||1;MAN.$$form=true;$(document).on('click','.ui-form-button-close',function(){SET($(this).attr('data-path'),'');window.$$form_level--});$(window).on('resize',function(){FIND('form',true).forEach(function(component){!component.element.hasClass('hidden')&&component.resize()})});$(document).on('click','.ui-form-container',function(e){var el= $(e.target);if(!(el.hasClass('ui-form-container-padding')||el.hasClass('ui-form-container')))return;var form= $(this).find('.ui-form');var cls='ui-form-animate-click';form.addClass(cls);setTimeout(function(){form.removeClass(cls)},300)})}self.readonly();self.submit=function(){self.hide()};self.cancel=function(){self.hide()};self.onHide=function(){};var hide=self.hide=function(){self.set('');self.onHide()};self.resize=function(){if(!autocenter)return;var ui=self.find('.ui-form');var fh=ui.innerHeight();var wh= $(window).height();var r=(wh/2)-(fh/2);if(r>30)ui.css({marginTop:(r-15)+'px'});else ui.css({marginTop:'20px'})};self.make=function(){var width=self.attr('data-width')||'800px';var enter=self.attr('data-enter');autocenter=self.attr('data-autocenter')==='true';self.condition=self.attr('data-if');$(document.body).append('<div id="{0}" class="hidden ui-form-container"><div class="ui-form-container-padding"><div class="ui-form" style="max-width:{1}"><div class="ui-form-title"><span class="fa fa-times ui-form-button-close" data-path="{2}"></span>{3}</div>{4}</div></div>'.format(self._id,width,self.path,self.attr('data-title')));var el= $('#'+self._id);el.find('.ui-form').get(0).appendChild(self.element.get(0));self.classes('-hidden');self.replace(el);self.event('scroll',function(){EMIT('reflow',self.name)});self.find('button').on('click',function(){window.$$form_level--;switch(this.name){case'submit':self.submit(hide);break;case'cancel':!this.disabled&&self[this.name](hide);break}});enter==='true'&&self.event('keydown','input',function(e){e.keyCode===13&&!self.find('button[name="submit"]').get(0).disabled&&self.submit(hide)})};self.setter=function(){setTimeout2('noscroll',function(){$('html').toggleClass('noscroll', $('.ui-form-container').not('.hidden').length?true:false)},50);var isHidden=!EVALUATE(self.path,self.condition);self.toggle('hidden',isHidden);EMIT('reflow',self.name);if(isHidden){self.release(true);self.find('.ui-form').removeClass('ui-form-animate');return}self.resize();self.release(false);var el=self.find('input[type="text"],select,textarea');el.length&&el.eq(0).focus();window.$$form_level++;self.css('z-index',window.$$form_level*10);self.element.scrollTop(0);setTimeout(function(){self.find('.ui-form').addClass('ui-form-animate')},300);setTimeout2(self.id,function(){self.css('z-index',(window.$$form_level*10)+1)},1000)}});COMPONENT('repeater-group',function(){var self=this;var template_group;var group;self.readonly();self.make=function(){group=self.attr('data-group');self.element.find('script').each(function(index){var element= $(this);var html=element.html();element.remove();if(index)template_group=Tangular.compile(html);else self.template=Tangular.compile(html)})};self.setter=function(value){if(!value||!value.length){self.empty();return}if(NOTMODIFIED(self.id,value))return;var length=value.length;var groups={};for(var i=0;i<length;i++){var name=value[i][group];if(!name)name='0';if(groups[name])groups[name].push(value[i]);else groups[name]=[value[i]]}var index=0;var indexgroup=0;var builder='';var keys=Object.keys(groups);keys.sort();keys.forEach(function(key){var arr=groups[key];var tmp='';for(var i=0,length=arr.length;i<length;i++){var item=arr[i];item.index=index++;tmp+=self.template(item).replace(/\$index/g,index.toString()).replace(/\$/g,self.path+'['+index+']')}if(key!=='0'){var options={};options[group]=key;options.length=arr.length;options.index=indexgroup++;options.body=tmp;builder+=template_group(options)}});self.empty().append(builder)}});COMPONENT('dropdowncheckbox',function(){var self=this;var required=self.attr('data-required')==='true';var container;var data=[];var values;var prepared=false;if(!window.$dropdowncheckboxtemplate)window.$dropdowncheckboxtemplate=Tangular.compile('<div><label><input type="checkbox" value="{{ index}}" /><span>{{ text}}</span></label></div>');var template=window.$dropdowncheckboxtemplate;self.validate=function(value){return required?value&&value.length>0:true};self.make=function(){var options=[];var element=self.element;var arr=(self.attr('data-options')||'').split(';');for(var i=0,length=arr.length;i<length;i++){var item=arr[i].split('|');var value=item[1]===undefined?item[0]:item[1];if(self.type==='number')value=parseInt(value);var obj={value:value,text:item[0],index:i};options.push(template(obj));data.push(obj)}var content=element.html();var icon=self.attr('data-icon');var html='<div class="ui-dropdowncheckbox"><span class="fa fa-sort"></span><div class="ui-dropdowncheckbox-selected"></div></div><div class="ui-dropdowncheckbox-values hidden">'+options.join('')+'</div>';if(content.length){element.empty();element.append('<div class="ui-dropdowncheckbox-label'+(required?' ui-dropdowncheckbox-label-required':'')+'">'+(icon?'<span class="fa '+icon+'"></span> ':'')+content+':</div>');element.append(html)}else element.append(html);self.toggle('ui-dropdowncheckbox-container');container=self.find('.ui-dropdowncheckbox-values');values=self.find('.ui-dropdowncheckbox-selected');self.event('click','.ui-dropdowncheckbox',function(e){var el= $(this);if(el.hasClass('ui-disabled'))return;container.toggleClass('hidden');if(window.$dropdowncheckboxelement){window.$dropdowncheckboxelement.addClass('hidden');window.$dropdowncheckboxelement=null}if(!container.hasClass('hidden'))window.$dropdowncheckboxelement=container;e.stopPropagation()});self.event('click','input,label',function(e){e.stopPropagation();var is=this.checked;var index=parseInt(this.value);var value=data[index];if(value===undefined)return;value=value.value;var arr=self.get();if(!(arr instanceof Array))arr=[];var index=arr.indexOf(value);if(is)index===-1&&arr.push(value);else index!==-1&&arr.splice(index,1);self.reset(true);self.set(arr,undefined,2);self.change(true)});var ds=self.attr('data-source');if(!ds){prepared=true;return}self.watch(ds,prepare);setTimeout(function(){prepare(ds,GET(ds))},500)};function prepare(path,value){var clsempty='ui-dropdowncheckbox-values-empty';prepared=true;if(!value){container.addClass(clsempty).empty().html(self.attr('data-empty'));return}var kv=self.attr('data-source-value')||'id';var kt=self.attr('data-source-text')||'name';var builder='';data=[];for(var i=0,length=value.length;i<length;i++){var isString=typeof(value[i])==='string';var item={value:isString?value[i]:value[i][kv],text:isString?value[i]:value[i][kt],index:i};data.push(item);builder+=template(item)}if(builder)container.removeClass(clsempty).empty().append(builder);else container.addClass(clsempty).empty().html(self.attr('data-empty'));self.setter(self.get())}self.setter=function(value){if(!prepared||NOTMODIFIED(self.id,value))return;var label='';var empty=self.attr('data-placeholder');if(value&&value.length){var remove=[];for(var i=0,length=value.length;i<length;i++){var selected=value[i];var index=0;var is=false;while(true){var item=data[index++];if(item===undefined)break;if(item.value!=selected)continue;label+=(label?', ':'')+item.text;is=true}!is&&remove.push(selected)}var refresh=false;while(true){var item=remove.shift();if(item===undefined)break;value.splice(value.indexOf(item),1);refresh=true}refresh&&MAN.set(self.path,value)}container.find('input').each(function(){var index=parseInt(this.value);var checked=false;if(!value||!value.length)checked=false;else if(data[index])checked=data[index];if(checked)checked=value.indexOf(checked.value)!==-1;this.checked=checked});!label&&value&&MAN.set(self.path,[]);if(!label&&empty){values.html('<span>{0}</span>'.format(empty));return}values.html(label)};self.state=function(){self.find('.ui-dropdowncheckbox').toggleClass('ui-dropdowncheckbox-invalid',self.isInvalid())};if(window.$dropdowncheckboxevent)return;window.$dropdowncheckboxevent=true;$(document).on('click',function(){if(window.$dropdowncheckboxelement){window.$dropdowncheckboxelement.addClass('hidden');window.$dropdowncheckboxelement=null}})});COMPONENT('codemirror',function(){var self=this;var required=self.attr('data-required')==='true';var skipA=false;var skipB=false;var editor;var isTyping=false;var currentH;var maxlength;self.validate=function(value){return required?value&&value.length>0:true};self.released=function(is){if(is){if(isMOBILE)editor.val('');else editor.setValue('')}};self.getValue=function(){var value=isMOBILE?editor.val():editor.getValue();return value.length>maxlength?value.substring(0,maxlength):value};self.codemirror=function(){return editor};self.focus=function(){editor.focus();return this};self.enter=function(){};self.upload=function(){};self.typing=function(){};self.edit=function(){};self.change2=function(){};self.make=function(){var height=self.attr('data-height');self.html('<div class="ui-codemirror"></div>');var container=self.find('.ui-codemirror');maxlength=(self.attr('data-maxlength')||'').parseInt();if(isMOBILE){self.append('<textarea maxlength="{0}" placeholder="{1}"></textarea>'.format(maxlength,self.attr('data-placeholder')));editor=self.find('textarea');editor.getSelection=function(){return editor.val()};editor.getValue=function(){return editor.val()};editor.replaceSelection=function(val){insertTextarea(editor.get(0),val)};editor.on('keypress',function(){if(isTyping){setTimeout2(self.id+'typing',function(){isTyping=false},5000);return}isTyping=true;self.typing()});editor.on('keydown',function(e){if(e.keyCode===13&&(e.metaKey||e.ctrlKey)){self.enter(1)!==CodeMirror.Pass&&e.preventDefault();return}if(e.keyCode===13){self.enter(0)!==CodeMirror.Pass&&e.preventDefault();return}if(e.keyCode===27){self.edit(false);return}if(e.keyCode===38){!editor.val()&&self.edit(true);return}});editor.on('change',function(){if(self.release())return;setTimeout2(self.id,function(){var val=editor.val();skipA=true;self.reset(true);self.dirty(false);self.set(val);CACHE('codemirror.'+NAVIGATION.url,val,'7 days')},200)});return}var options={};options.autoSuggest=[];options.autoSuggest.push({mode:'markdown',startChar:'@',listCallback:function(linker){var reg=/-/g;linker=linker.replace(reg,'');var arr=[];if(current.route.type==='user'){arr.push({text:current.route.item.linker,displayText:current.route.item.name})}else{if(common.history&&common.history.length){var has={};common.history.forEach(function(item){if(!has[item.user.id]&&item.user.id!==user.id&&item.user.linker.replace(reg,'').indexOf(linker)!==-1){has[item.user.id]=true;arr.push({text:item.user.linker,displayText:item.user.name})}})}else{for(var i=0,length=current.users.length;i<length;i++){if(arr.length>9)break;var item=current.users[i];if(item.id!==user.id&&item.linker.replace(reg,'').indexOf(linker)!==-1)arr.push({text:item.linker,displayText:item.name})}}}arr.length&&arr.quicksort('displayText');return arr}});options.lineNumbers=self.attr('data-linenumbers')==='true';options.lineWrapping=true;options.mode=self.attr('data-type')||'htmlmixed';options.indentUnit=4;options.placeholder=self.attr('data-placeholder');options.extraKeys={};options.extraKeys['Enter']=function(){return self.enter(0)};options.extraKeys['Cmd-Enter']=function(){return self.enter(1)};options.extraKeys['Up']=function(){if(editor.getValue())return CodeMirror.Pass;self.edit(true)};options.extraKeys['Esc']=function(){self.edit(false);return CodeMirror.pass};options.extraKeys['Ctrl-Enter']=function(){return self.enter(1)};editor=CodeMirror(container.get(0),options);editor.on('dragover',function(){self.element.addClass('ui-codemirror-dragdrop')});editor.on('dragleave',function(){self.element.removeClass('ui-codemirror-dragdrop')});editor.on('drop',function(editor,e){self.element.removeClass('ui-codemirror-dragdrop');self.upload(editor,e)});maxlength&&editor.setOption('maxlength',maxlength);editor.on('update',function(){var h=editor.getScrollerElement().clientHeight;if(currentH!==h){currentH=h;EMIT('resize')}});editor.on('keypress',function(e){if(isTyping){setTimeout2(self.id+'typing',function(){isTyping=false},5000);return}isTyping=true;self.typing()});height!=='auto'&&editor.setSize('100%',height||'100px');editor.on('change',function(a,b){if(self.release())return;if(skipB&&b.origin!=='paste'){skipB=false;return}setTimeout2(self.id,function(){var val=editor.getValue();skipA=true;self.reset(true);self.dirty(false);self.set(val);CACHE('codemirror.'+NAVIGATION.url,val,'7 days')},200)});editor.on('beforeChange',function(cm,change){var maxlength=cm.getOption('maxlength');if(maxlength&&change.update){var str=change.text.join('\n');var delta=str.length-(cm.indexFromPos(change.to)-cm.indexFromPos(change.from));if(delta<=0)return true;delta=cm.getValue().length+delta-maxlength;if(delta){str=str.substr(0,str.length-delta);change.update(change.from,change.to,str.split('\n'))}}});skipB=true};self.reload=function(){var val=CACHE('codemirror.'+NAVIGATION.url)||'';setTimeout2(self.id,function(){self.set(val)},500)};self.setter=function(value,path,type){if(skipA===true){skipA=false;return}type&&CACHE('codemirror.'+NAVIGATION.url,value,'7 days');if(isMOBILE){editor.val(value||'');return}skipB=true;editor.setValue(value||'');editor.refresh();skipB=true;CodeMirror.commands['selectAll'](editor);skipB=true;editor.setValue(editor.getValue());editor.setCursor(editor.lineCount(),0);skipB=true;setTimeout(function(){editor.refresh()},200);setTimeout(function(){editor.refresh()},1000)};self.state=function(){self.find('.ui-codemirror').toggleClass('ui-codemirror-invalid',self.isInvalid())}});COMPONENT('confirm',function(){var self=this;var is=false;self.readonly();self.singleton();self.make=function(){self.toggle('ui-confirm hidden',true);self.event('click','button',function(){self.hide($(this).attr('data-index').parseInt())});self.event('click',function(e){if(e.target.tagName!=='DIV')return;var el=self.find('.ui-confirm-body');el.addClass('ui-confirm-click');setTimeout(function(){el.removeClass('ui-confirm-click')},300)})};self.confirm=function(message,buttons,fn){self.callback=fn;var builder=[];buttons.forEach(function(item,index){builder.push('<button data-index="{1}">{0}</button>'.format(item,index))});self.content('ui-confirm-warning','<div class="ui-confirm-message">{0}</div>{1}'.format(message.replace(/\n/g,'<br />'),builder.join('')))};self.hide=function(index){self.callback&&self.callback(index);self.classes('-ui-confirm-visible');setTimeout2(self.id,function(){self.classes('hidden')},1000)};self.content=function(cls,text){!is&&self.html('<div><div class="ui-confirm-body"></div></div>');self.find('.ui-confirm-body').empty().append(text);self.classes('-hidden');setTimeout2(self.id,function(){self.classes('ui-confirm-visible')},5)}});COMPONENT('loading',function(){var self=this;var pointer;self.readonly();self.singleton();self.make=function(){self.classes('ui-loading')};self.show=function(){clearTimeout(pointer);self.classes('-hidden');return self};self.hide=function(timeout){clearTimeout(pointer);pointer=setTimeout(function(){self.classes('+hidden')},timeout||1);return self}});COMPONENT('search',function(){var self=this;var options_class;var options_selector;var options_attribute;var options_delay;self.readonly();self.make=function(){options_class=self.attr('data-class')||'hidden';options_selector=self.attr('data-selector');options_attribute=self.attr('data-attribute')||'data-search';options_delay=(self.attr('data-delay')||'200').parseInt()};self.setter=function(value){if(!options_selector||!options_attribute||value==null)return;KEYPRESS(function(){var elements=self.find(options_selector);if(!value){elements.removeClass(options_class);return}var search=value.toLowerCase().toSearch();var hide=[];var show=[];elements.toArray().waitFor(function(item,next){var el= $(item);var val=(el.attr(options_attribute)||'').toSearch();if(val.indexOf(search)===-1)hide.push(el);else show.push(el);next()},function(){hide.forEach(function(item){item.toggleClass(options_class,true)});show.forEach(function(item){item.toggleClass(options_class,false)})})},options_delay,'search'+self.id)}});COMPONENT('binder',function(){var self=this;var keys;var keys_unique;self.readonly();self.blind();self.make=function(){self.watch('*',self.autobind);self.scan();self.on('component',function(){setTimeout2(self.id,self.scan,200)});self.on('destroy',function(){setTimeout2(self.id,self.scan,200)})};self.autobind=function(path){var mapper=keys[path];var template={};mapper&&mapper.forEach(function(item){var value=self.get(item.path);template.value=value;item.classes&&classes(item.element,item.classes(value));item.visible&&item.element.toggleClass('hidden',item.visible(value)?false:true);item.html&&item.element.html(item.html(value));item.template&&item.element.html(item.template(template))})};function classes(element,val){var add='';var rem='';val.split(' ').forEach(function(item){switch(item.substring(0,1)){case'+':add+=(add?' ':'')+item.substring(1);break;case'-':rem+=(rem?' ':'')+item.substring(1);break;default:add+=(add?' ':'')+item;break}});rem&&element.removeClass(rem);add&&element.addClass(add)}function decode(val){return val.replace(/\&\#39;/g,'\'')}self.prepare=function(code){return code.indexOf('=>')===-1?FN('value=>'+decode(code)):FN(decode(code))};self.scan=function(){keys={};keys_unique={};self.find('[data-b]').each(function(){var el= $(this);var path=el.attr('data-b');var arr=path.split('.');var p='';var classes=el.attr('data-b-class');var html=el.attr('data-b-html');var visible=el.attr('data-b-visible');var obj=el.data('data-b');keys_unique[path]=true;if(!obj){obj={};obj.path=path;obj.element=el;obj.classes=classes?self.prepare(classes):undefined;obj.visible=visible?self.prepare(visible):undefined;if(self.attr('data-b-template')==='true'){var tmp=el.find('script[type="text/html"]');var str='';if(tmp.length)str=tmp.html();else str=el.html();if(str.indexOf('{{')!==-1){obj.template=Tangular.compile(str);tmp.length&&tmp.remove()}}else obj.html=html?self.prepare(html):undefined;el.data('data-b',obj)}for(var i=0,length=arr.length;i<length;i++){p+=(p?'.':'')+arr[i];if(keys[p])keys[p].push(obj);else keys[p]=[obj]}});Object.keys(keys_unique).forEach(function(key){self.autobind(key,self.get(key))});return self}});COMPONENT('websocket',function(){var reconnect_timeout;var self=this;var ws,url;var queue=[];var sending=false;self.online=false;self.readonly();self.make=function(){reconnect_timeout=(self.attr('data-reconnect')||'2000').parseInt();url=self.attr('data-url');if(!url.match(/^(ws|wss)\:\/\//))url=(location.protocol.length===6?'wss':'ws')+'://'+location.host+(url.substring(0,1)!=='/'?'/':'')+url;setTimeout(self.connect,500);self.destroy=self.close};self.send=function(obj){queue.push(encodeURIComponent(JSON.stringify(obj)));self.process();return self};self.process=function(callback){if(!ws||sending||!queue.length||ws.readyState!==1){callback&&callback();return}sending=true;var async=queue.splice(0,3);async.waitFor(function(item,next){ws.send(item);setTimeout(next,5)},function(){callback&&callback();sending=false;queue.length&&self.process()})};self.close=function(isClosed){if(!ws)return self;self.online=false;ws.onopen=ws.onclose=ws.onmessage=null;!isClosed&&ws.close();ws=null;EMIT('online',false);return self};function onClose(){self.close(true);setTimeout(self.connect,reconnect_timeout)}function onMessage(e){var data;try{data=JSON.parse(decodeURIComponent(e.data));self.attr('data-jc-path')&&self.set(data)}catch(e){window.console&&console.warn('WebSocket "{0}": {1}'.format(url,e.toString()))}data&&EMIT('message',data)}function onOpen(){self.online=true;self.process(function(){EMIT('online',true)})}self.connect=function(){ws&&self.close();setTimeout2(self.id,function(){ws=new WebSocket(url);ws.onopen=onOpen;ws.onclose=onClose;ws.onmessage=onMessage},100);return self}});COMPONENT('typing',function(){var self=this;var cache={};var empty=true;var count=0;var max;self.readonly();self.make=function(){max=(self.attr('data-max')||'4').parseInt();self.classes('ui-typing hidden-xs');var scr=self.find('script');self.template=Tangular.compile(scr.html());scr.remove();setInterval(function(){if(empty)return;var dt=new Date();Object.keys(cache).forEach(function(id){if(cache[id]>dt)return;delete cache[id];count--;self.find('div[data-id="{0}"]'.format(id)).remove()})},5000)};self.clear=function(){count=0;cache={};self.empty()};self.insert=function(user){if(count>max)return;var is=cache[user.id]?true:false;cache[user.id]=new Date().add('5 seconds');empty=false;count++;!is&&self.append(self.template(user))}});COMPONENT('importer',function(){var self=this;var imported=false;var reload=self.attr('data-reload');self.readonly();self.setter=function(){if(!self.evaluate(self.attr('data-if')))return;if(imported){if(reload)EXEC(reload);else self.setter=null;return}imported=true;IMPORT(self.attr('data-url'),function(){if(reload)EXEC(reload);else self.remove()})}});COMPONENT('audio',function(){var self=this;var can=false;var volume=0.5;var cache={};self.items=[];self.readonly();self.singleton();self.make=function(){var audio=document.createElement('audio');if(audio.canPlayType&&audio.canPlayType('audio/mpeg').replace(/no/,''))can=true};self.play=function(url){if(!can||cache[url])return;var audio=new window.Audio();audio.src=url;audio.volume=volume;audio.play();cache[url]=true;audio.onended=function(){audio.$destroy=true;delete cache[url];self.cleaner()};audio.onerror=function(){audio.$destroy=true;delete cache[url];self.cleaner()};audio.onabort=function(){audio.$destroy=true;delete cache[url];self.cleaner()};self.items.push(audio);return self};self.cleaner=function(){var index=0;while(true){var item=self.items[index++];if(item===undefined)return self;if(!item.$destroy)continue;item.pause();item.onended=null;item.onerror=null;item.onsuspend=null;item.onabort=null;item=null;index--;self.items.splice(index,1)}};self.stop=function(url){delete cache[url];if(!url){self.items.forEach(function(item){item.$destroy=true});return self.cleaner()}var index=self.items.findIndex('src',url);if(index===-1)return self;self.items[index].$destroy=true;return self.cleaner()};self.setter=function(value){if(value===undefined)value=0.5;else value=(value/100);if(value>1)value=1;else if(value<0)value=0;volume=value?+value:0;for(var i=0,length=self.items.length;i<length;i++){var a=self.items[i];if(!a.$destroy)a.volume=value}}});COMPONENT('pictureupload',function(){var self=this;var width=+self.attr('data-width');var height=+self.attr('data-height');var url=self.attr('data-url')||location.pathname;var empty;var img;self.noValidate();self.make=function(){var canvas=document.createElement('canvas');canvas.width=width;canvas.height=height;var bg=self.attr('data-background');if(bg){var ctx=canvas.getContext('2d');ctx.fillStyle=bg;ctx.fillRect(0,0,width,height)}empty=canvas.toDataURL('image/png');canvas=null;var html=self.html();var icon=self.attr('data-icon');self.toggle('ui-pictureupload');self.html((html?'<div class="ui-pictureupload-label">{0}{1}:</div>'.format(icon?'<i class="fa {0}"></i>'.format(icon):'',html):'')+'<input type="file" accept="image/*" class="hidden" /><img src="{0}" class="img-responsive" alt="" />'.format(empty,width,height));img=self.find('img');img.on('click',function(){self.find('input').trigger('click')});self.event('change','input',function(evt){self.upload(evt.target.files)});self.event('dragenter dragover dragexit drop dragleave',function(e){e.stopPropagation();e.preventDefault();switch(e.type){case'drop':break;case'dragenter':case'dragover':return;case'dragexit':case'dragleave':default:return}self.upload(e.originalEvent.dataTransfer.files)})};self.upload=function(files){if(!files.length)return;var el=this;var data=new FormData();data.append('file',files[0]);data.append('width',width);data.append('height',height);UPLOAD(url,data,function(response,err){SETTER('loading','hide',100);if(err){SETTER('message','warning',self.attr('data-error-large'));return}el.value='';self.set(response,undefined,2);self.change(true)})};self.setter=function(value){if(value)img.attr('src',(self.attr('data-path')||'{0}').format(value));else img.attr('src',empty)}});COMPONENT('nativenotifications',function(){var self=this;var autoclosing;var system=false;var N=window.Notification;self.singleton();self.readonly();self.items=[];self.make=function(){if(!N)return;system=N.permission==='granted';!system&&N.requestPermission(function(permission){system=permission==='granted'})};self.append=function(title,message,callback,img){if(!system||!self.get())return;var obj={id:Math.floor(Math.random()*100000),date:new Date(),callback:callback};var options={};options.body=message.replace(/(<([^>]+)>)/ig,'');self.items.push(obj);self.autoclose();if(img===undefined)options.icon='/icon.png';else if(img!=null)options.icon=img;obj.system=new N(title,options);obj.system.onclick=function(){window.focus();self.items=self.items.remove('id',obj.id);if(obj.callback){obj.callback();obj.callback=null}obj.system.close();obj.system.onclick=null;obj.system=null}};self.autoclose=function(){if(autoclosing)return self;autoclosing=setTimeout(function(){clearTimeout(autoclosing);autoclosing=null;var obj=self.items.shift();if(obj){obj.system.onclick=null;obj.system.close();obj.system=null}self.items.length&&self.autoclose()},+self.attr('data-timeout')||8000)}});COMPONENT('clipboardimage',function(){var self=this;var ctx,img,canvas,maxW,maxH,quality;self.singleton();self.readonly();self.blind();self.make=function(){self.classes('hidden');self.append('<canvas></canvas><img src="data:image/png;base64,R0lGODdhAQABAIAAAHnrWAAAACH5BAEAAAEALAAAAAABAAEAAAICTAEAOw==" />');canvas=self.find('canvas').get(0);ctx=canvas.getContext('2d');img=self.find('img').get(0);maxW=(self.attr('data-width')||'1280').parseInt();maxH=(self.attr('data-height')||'1024').parseInt();quality=(self.attr('data-quality')||'90').parseInt()*0.01;$(window).on('paste',function(e){var item=e.originalEvent.clipboardData.items[0];if(item.kind!=='file'||item.type.substring(0,5)!=='image')return;var blob=item.getAsFile();var reader=new FileReader();reader.onload=function(e){img.onload=function(){self.resize()};img.src=e.target.result};reader.readAsDataURL(blob)})};self.resize=function(){var dpr=window.devicePixelRatio;if(dpr>1){canvas.width=img.width/dpr;canvas.height=img.height/dpr}else{canvas.width=img.width;canvas.height=img.height}if(canvas.width>maxW){canvas.width=maxW;canvas.height=(maxW/(img.width/img.height))>>0}else if(canvas.height>maxH){canvas.height=maxH;canvas.width=(maxH/(img.width/img.height))>>0}ctx.drawImage(img,0,0,canvas.width,canvas.height);EMIT('clipboardimage',canvas.toDataURL('image/jpeg',quality))}});COMPONENT('fontawesome',function(){var self=this;var icons='500px,address-book,address-book-o,address-card,address-card-o,adjust,adn,align-center,align-justify,align-left,align-right,amazon,ambulance,american-sign-language-interpreting,anchor,android,angellist,angle-double-down,angle-double-left,angle-double-right,angle-double-up,angle-down,angle-left,angle-right,angle-up,apple,archive,area-chart,arrow-circle-down,arrow-circle-left,arrow-circle-o-down,arrow-circle-o-left,arrow-circle-o-right,arrow-circle-o-up,arrow-circle-right,arrow-circle-up,arrow-down,arrow-left,arrow-right,arrow-up,arrows,arrows-alt,arrows-h,arrows-v,asl-interpreting,assistive-listening-systems,asterisk,at,audio-description,automobile,backward,balance-scale,ban,bandcamp,bank,bar-chart,bar-chart-o,barcode,bars,bath,bathtub,battery,battery-0,battery-1,battery-2,battery-3,battery-4,battery-empty,battery-full,battery-half,battery-quarter,battery-three-quarters,bed,beer,behance,behance-square,bell,bell-o,bell-slash,bell-slash-o,bicycle,binoculars,birthday-cake,bitbucket,bitbucket-square,bitcoin,black-tie,blind,bluetooth,bluetooth-b,bold,bolt,bomb,book,bookmark,bookmark-o,braille,briefcase,btc,bug,building,building-o,bullhorn,bullseye,bus,buysellads,cab,calculator,calendar,calendar-check-o,calendar-minus-o,calendar-o,calendar-plus-o,calendar-times-o,camera,camera-retro,car,caret-down,caret-left,caret-right,caret-square-o-down,caret-square-o-left,caret-square-o-right,caret-square-o-up,caret-up,cart-arrow-down,cart-plus,cc,cc-amex,cc-diners-club,cc-discover,cc-jcb,cc-mastercard,cc-paypal,cc-stripe,cc-visa,certificate,chain,chain-broken,check,check-circle,check-circle-o,check-square,check-square-o,chevron-circle-down,chevron-circle-left,chevron-circle-right,chevron-circle-up,chevron-down,chevron-left,chevron-right,chevron-up,child,chrome,circle,circle-o,circle-o-notch,circle-thin,clipboard,clock-o,clone,close,cloud,cloud-download,cloud-upload,cny,code,code-fork,codepen,codiepie,coffee,cog,cogs,columns,comment,comment-o,commenting,commenting-o,comments,comments-o,compass,compress,connectdevelop,contao,copy,copyright,creative-commons,credit-card,credit-card-alt,crop,crosshairs,css3,cube,cubes,cut,cutlery,dashboard,dashcube,database,deaf,deafness,dedent,delicious,desktop,deviantart,diamond,digg,dollar,dot-circle-o,download,dribbble,drivers-license,drivers-license-o,dropbox,drupal,edge,edit,eercast,eject,ellipsis-h,ellipsis-v,empire,envelope,envelope-o,envelope-open,envelope-open-o,envelope-square,envira,eraser,etsy,eur,euro,exchange,exclamation,exclamation-circle,exclamation-triangle,expand,expeditedssl,external-link,external-link-square,eye,eye-slash,eyedropper,fa,facebook,facebook-f,facebook-official,facebook-square,fast-backward,fast-forward,fax,feed,female,fighter-jet,file,file-archive-o,file-audio-o,file-code-o,file-excel-o,file-image-o,file-movie-o,file-o,file-pdf-o,file-photo-o,file-picture-o,file-powerpoint-o,file-sound-o,file-text,file-text-o,file-video-o,file-word-o,file-zip-o,files-o,film,filter,fire,fire-extinguisher,firefox,first-order,flag,flag-checkered,flag-o,flash,flask,flickr,floppy-o,folder,folder-o,folder-open,folder-open-o,font,font-awesome,fonticons,fort-awesome,forumbee,forward,foursquare,free-code-camp,frown-o,futbol-o,gamepad,gavel,gbp,ge,gear,gears,genderless,get-pocket,gg,gg-circle,gift,git,git-square,github,github-alt,github-square,gitlab,gittip,glass,glide,glide-g,globe,google,google-plus,google-plus-circle,google-plus-official,google-plus-square,google-wallet,graduation-cap,gratipay,grav,group,h-square,hacker-news,hand-grab-o,hand-lizard-o,hand-o-down,hand-o-left,hand-o-right,hand-o-up,hand-paper-o,hand-peace-o,hand-pointer-o,hand-rock-o,hand-scissors-o,hand-spock-o,hand-stop-o,handshake-o,hard-of-hearing,hashtag,hdd-o,header,headphones,heart,heart-o,heartbeat,history,home,hospital-o,hotel,hourglass,hourglass-1,hourglass-2,hourglass-3,hourglass-end,hourglass-half,hourglass-o,hourglass-start,houzz,html5,i-cursor,id-badge,id-card,id-card-o,ils,image,imdb,inbox,indent,industry,info,info-circle,inr,instagram,institution,internet-explorer,intersex,ioxhost,italic,joomla,jpy,jsfiddle,key,keyboard-o,krw,language,laptop,lastfm,lastfm-square,leaf,leanpub,legal,lemon-o,level-down,level-up,life-bouy,life-buoy,life-ring,life-saver,lightbulb-o,line-chart,link,linkedin,linkedin-square,linode,linux,list,list-alt,list-ol,list-ul,location-arrow,lock,long-arrow-down,long-arrow-left,long-arrow-right,long-arrow-up,low-vision,magic,magnet,mail-forward,mail-reply,mail-reply-all,male,map,map-marker,map-o,map-pin,map-signs,mars,mars-double,mars-stroke,mars-stroke-h,mars-stroke-v,maxcdn,meanpath,medium,medkit,meetup,meh-o,mercury,microchip,microphone,microphone-slash,minus,minus-circle,minus-square,minus-square-o,mixcloud,mobile,mobile-phone,modx,money,moon-o,mortar-board,motorcycle,mouse-pointer,music,navicon,neuter,newspaper-o,object-group,object-ungroup,odnoklassniki,odnoklassniki-square,opencart,openid,opera,optin-monster,outdent,pagelines,paint-brush,paper-plane,paper-plane-o,paperclip,paragraph,paste,pause,pause-circle,pause-circle-o,paw,paypal,pencil,pencil-square,pencil-square-o,percent,phone,phone-square,photo,picture-o,pie-chart,pied-piper,pied-piper-alt,pied-piper-pp,pinterest,pinterest-p,pinterest-square,plane,play,play-circle,play-circle-o,plug,plus,plus-circle,plus-square,plus-square-o,podcast,power-off,print,product-hunt,puzzle-piece,qq,qrcode,question,question-circle,question-circle-o,quora,quote-left,quote-right,ra,random,ravelry,rebel,recycle,reddit,reddit-alien,reddit-square,refresh,registered,remove,renren,reorder,repeat,reply,reply-all,resistance,retweet,rmb,road,rocket,rotate-left,rotate-right,rouble,rss,rss-square,rub,ruble,rupee,s15,safari,save,scissors,scribd,search,search-minus,search-plus,sellsy,send,send-o,server,share,share-alt,share-alt-square,share-square,share-square-o,shekel,sheqel,shield,ship,shirtsinbulk,shopping-bag,shopping-basket,shopping-cart,shower,sign-in,sign-language,sign-out,signal,signing,simplybuilt,sitemap,skyatlas,skype,slack,sliders,slideshare,smile-o,snapchat,snapchat-ghost,snapchat-square,snowflake-o,soccer-ball-o,sort,sort-alpha-asc,sort-alpha-desc,sort-amount-asc,sort-amount-desc,sort-asc,sort-desc,sort-down,sort-numeric-asc,sort-numeric-desc,sort-up,soundcloud,space-shuttle,spinner,spoon,spotify,square,square-o,stack-exchange,stack-overflow,star,star-half,star-half-empty,star-half-full,star-half-o,star-o,steam,steam-square,step-backward,step-forward,stethoscope,sticky-note,sticky-note-o,stop,stop-circle,stop-circle-o,street-view,strikethrough,stumbleupon,stumbleupon-circle,subscript,subway,suitcase,sun-o,superpowers,superscript,support,table,tablet,tachometer,tag,tags,tasks,taxi,telegram,television,tencent-weibo,terminal,text-height,text-width,th,th-large,th-list,themeisle,thermometer,thermometer-0,thermometer-1,thermometer-2,thermometer-3,thermometer-4,thermometer-empty,thermometer-full,thermometer-half,thermometer-quarter,thermometer-three-quarters,thumb-tack,thumbs-down,thumbs-o-down,thumbs-o-up,thumbs-up,ticket,times,times-circle,times-circle-o,times-rectangle,times-rectangle-o,tint,toggle-down,toggle-left,toggle-off,toggle-on,toggle-right,toggle-up,trademark,train,transgender,transgender-alt,trash,trash-o,tree,trello,tripadvisor,trophy,truck,try,tty,tumblr,tumblr-square,turkish-lira,tv,twitch,twitter,twitter-square,umbrella,underline,undo,universal-access,university,unlink,unlock,unlock-alt,unsorted,upload,usb,usd,user,user-circle,user-circle-o,user-md,user-o,user-plus,user-secret,user-times,users,vcard,vcard-o,venus,venus-double,venus-mars,viacoin,viadeo,viadeo-square,video-camera,vimeo,vimeo-square,vine,vk,volume-control-phone,volume-down,volume-off,volume-up,warning,wechat,weibo,weixin,whatsapp,wheelchair,wheelchair-alt,wifi,wikipedia-w,window-close,window-close-o,window-maximize,window-minimize,window-restore,windows,won,wordpress,wpbeginner,wpexplorer,wpforms,wrench,xing,xing-square,y-combinator,y-combinator-square,yahoo,yc,yc-square,yelp,yen,yoast,youtube,youtube-play,youtube-square'.split(',');var container,recent,input,icon;var template='<li data-search="{0}"><i class="fa fa-{0}"></i></li>';var opener={};var is=false;self.singleton();self.readonly();self.blind();self.make=function(){self.classes('ui-fontawesome hidden');self.append('<div class="ui-fontawesome-search"><span><i class="fa fa-search clearsearch"></i></span><div><input type="text" maxlength="50" placeholder="{0}" /></div></div><div></div><ul class="ui-fontawesome-recentlist hidden"></ul><div class="ui-fontawesome-icons"><ul></ul></div>'.format(self.attr('data-search')));container= $(self.find('.ui-fontawesome-icons').find('ul').get(0));recent= $(self.find('.ui-fontawesome-recentlist').get(0));input=self.find('input');icon=self.find('.ui-fontawesome-search').find('.fa');self.event('click','.clearsearch',function(){input.val('').trigger('keydown')});self.event('click','li',function(){var icon= $(this).find('.fa').attr('class').replace('fa ','');var recent=CACHE(self.name)||[];var item=recent.findItem('name',icon);if(item){item.count++;recent.quicksort('count',false)}else{recent.length>13&&recent.pop();recent.push({name:icon,count:1})}CACHE(self.name,recent,'1 month');self.hide();opener.callback&&opener.callback(icon,opener.target);EMIT('fontawesome',icon,opener.target)});self.event('keydown','input',function(){var self=this;setTimeout2(self.id,function(){var hide=[];var show=[];var value=self.value.toSearch();container.find('li').each(function(){if(value&&this.getAttribute('data-search').toSearch().indexOf(value)===-1)hide.push(this);else show.push(this)});$(hide).addClass('hidden');$(show).removeClass('hidden');icon.toggleClass('fa-times',value?true:false).toggleClass('fa-search',value?false:true)},300)});self.on('reflow',function(){is&&self.hide()});self.on('resize',function(){is&&self.hide()})};self.render=function(){var builder=[];for(var i=0,length=icons.length;i<length;i++)builder.push(template.format(icons[i]));container.empty().html(builder.join(''))};self.clear=function(){container.empty();recent.empty()};self.hide=function(){if(!is)return;self.classes('hidden');self.clear();input.val('');icon.removeClass('fa-times').addClass('fa-search');is=false};self.show=function(x,y,target,callback){if(is&&opener.x===x&&opener.y===y){opener.x=null;opener.y=null;self.hide();return}if(typeof(target)==='function'){callback=target;target=null}opener.callback=callback;opener.target=target;opener.x=x;opener.y=y;if(!is){self.render();self.render_recent()}is=true;self.element.css({left:x,top:y}).removeClass('hidden');!isMOBILE&&input.focus()};self.render_recent=function(){var items=CACHE(self.name);if(items){var builder=[];items.forEach(function(item,index){index<13&&builder.push(template.format(item.name.replace('fa-','')))});recent.empty().html(builder.join('')).removeClass('hidden')}else recent.addClass('hidden');self.toggle('ui-fontawesome-recent',items&&items.length?true:false)}});COMPONENT('nosqlcounter',function(){var self=this;var count=(self.attr('data-count')||'0').parseInt();var months=['January','February','March','April','May','June','July','August','September','October','November','December'];self.readonly();self.make=function(){self.toggle('ui-nosqlcounter hidden',true);var calendar=FIND('calendar');calendar&&(months=calendar.months)};self.setter=function(value){var is=!value||!value.length;self.toggle('hidden',is);if(is)return self.empty();var maxbars=12;if(count===0)maxbars=self.element.width()/30>>0;else maxbars=count;if(WIDTH()==='xs')maxbars=maxbars/2;var dt=new Date();var current=dt.format('yyyyMM');var stats=null;if(self.attr('data-lastvalues')==='true'){var max=value.length-maxbars;if(max<0)max=0;stats=value.slice(max,value.length)}else{stats=[];for(var i=0;i<maxbars;i++){var id=dt.format('yyyyMM');var item=value.findItem('id',id);stats.push(item?item:{id:id,month:dt.getMonth()+1,year:dt.getFullYear(),value:0});dt=dt.add('-1 month')}stats.reverse()}var max=stats.scalar('max','value');var bar=100/maxbars;var builder=[];var cls='';stats.forEach(function(item,index){var val=item.value;if(val>999)val=(val/1000).format(1,2)+'K';var h=(item.value/max)*60;h+=40;cls=item.value?'':'empty';if(item.id===current)cls+=(cls?' ':'')+'current';if(index===maxbars-1)cls+=(cls?' ':'')+'last';builder.push('<div style="width:{0}%;height:{1}%" title="{3}" class="{4}"><span>{2}</span></div>'.format(bar.format(2,''),h.format(0,''),val,months[item.month-1]+' '+item.year,cls))});self.html(builder)}});MAIN.parser(function(path,value,type){if(type==='date'){if(value instanceof Date)return value;if(!value)return null;var isEN=value.indexOf('.')===-1;var tmp=isEN?value.split('-'):value.split('.');if(tmp.length!==3)return null;var dt=isEN?new Date(parseInt(tmp[0])||0,(parseInt(tmp[1],10)||0)-1,parseInt(tmp[2],10)||0):new Date(parseInt(tmp[2])||0,(parseInt(tmp[1],10)||0)-1,parseInt(tmp[0],10)||0);return dt}return value});COMPONENT('calendar',function(){var self=this;var skip=false;var skipDay=false;var visible=false;self.days=self.attr('data-days').split(',');self.months=self.attr('data-months').split(',');self.first=parseInt(self.attr('data-firstday'));self.today=self.attr('data-today');self.months_short=[];for(var i=0,length=self.months.length;i<length;i++){var m=self.months[i];if(m.length>4)m=m.substring(0,3)+'.';self.months_short.push(m)}self.readonly();self.click=function(){};function getMonthDays(dt){var m=dt.getMonth();var y=dt.getFullYear();if(m===-1){m=11;y--}return(32-new Date(y,m,32).getDate())}function calculate(year,month,selected){var d=new Date(year,month,1);var output={header:[],days:[],month:month,year:year};var firstDay=self.first;var firstCount=0;var from=d.getDay()-firstDay;var today=new Date();var ty=today.getFullYear();var tm=today.getMonth();var td=today.getDate();var sy=selected?selected.getFullYear():-1;var sm=selected?selected.getMonth():-1;var sd=selected?selected.getDate():-1;var days=getMonthDays(d);if(from<0)from=7+from;while(firstCount++<7){output.header.push({index:firstDay,name:self.days[firstDay]});firstDay++;if(firstDay>6)firstDay=0}var index=0;var indexEmpty=0;var count=0;var prev=getMonthDays(new Date(year,month-1,1))-from;for(var i=0;i<days+from;i++){var obj={isToday:false,isSelected:false,isEmpty:false,isFuture:false,number:0,index:++count};if(i>=from){obj.number=++index;obj.isSelected=sy===year&&sm===month&&sd===index;obj.isToday=ty===year&&tm===month&&td===index;obj.isFuture=ty<year;if(!obj.isFuture&&year===ty){if(tm<month)obj.isFuture=true;else if(tm===month)obj.isFuture=td<index}}else{indexEmpty++;obj.number=prev+indexEmpty;obj.isEmpty=true}output.days.push(obj)}indexEmpty=0;for(var i=count;i<42;i++)output.days.push({isToday:false,isSelected:false,isEmpty:true,isFuture:false,number:++indexEmpty,index:++count});return output}self.hide=function(){self.classes('hidden');visible=false;return self};self.toggle=function(el,value,callback,offset){if(self.element.hasClass('hidden'))self.show(el,value,callback,offset);else self.hide();return self};self.show=function(el,value,callback,offset){if(!el)return self.hide();var off=el.offset();var h=el.innerHeight();self.css({left:off.left+(offset||0),top:off.top+h+12}).removeClass('hidden');self.click=callback;self.date(value);visible=true;return self};self.make=function(){self.classes('ui-calendar hidden');self.event('click','.ui-calendar-today',function(){var dt=new Date();self.hide();self.click&&self.click(dt)});self.event('click','.ui-calendar-day',function(){var arr=this.getAttribute('data-date').split('-');var dt=new Date(parseInt(arr[0]),parseInt(arr[1]),parseInt(arr[2]));self.find('.ui-calendar-selected').removeClass('ui-calendar-selected');$(this).addClass('ui-calendar-selected');skip=true;self.hide();self.click&&self.click(dt)});self.event('click','button',function(e){e.preventDefault();e.stopPropagation();var arr=this.getAttribute('data-date').split('-');var dt=new Date(parseInt(arr[0]),parseInt(arr[1]),1);switch(this.name){case'prev':dt.setMonth(dt.getMonth()-1);break;case'next':dt.setMonth(dt.getMonth()+1);break}skipDay=true;self.date(dt)});$(document.body).on('scroll',function(){visible&&EXEC('$calendar.hide')});window.$calendar=self;self.on('reflow',function(){visible&&EXEC('$calendar.hide')})};self.date=function(value){if(typeof(value)==='string')value=value.parseDate();var empty=!value;if(skipDay){skipDay=false;empty=true}if(skip){skip=false;return}if(!value)value=new Date();var output=calculate(value.getFullYear(),value.getMonth(),value);var builder=[];for(var i=0;i<42;i++){var item=output.days[i];if(i%7===0){builder.length&&builder.push('</tr>');builder.push('<tr>')}var cls=[];if(item.isEmpty)cls.push('ui-calendar-disabled');else cls.push('ui-calendar-day');!empty&&item.isSelected&&cls.push('ui-calendar-selected');item.isToday&&cls.push('ui-calendar-day-today');builder.push('<td class="{0}" data-date="{1}-{2}-{3}">{3}</td>'.format(cls.join(' '),output.year,output.month,item.number))}builder.push('</tr>');var header=[];for(var i=0;i<7;i++)header.push('<th>{0}</th>'.format(output.header[i].name));self.html('<div class="ui-calendar-header"><button class="ui-calendar-header-prev" name="prev" data-date="{0}-{1}"><span class="fa fa-chevron-left"></span></button><div class="ui-calendar-header-info">{2} {3}</div><button class="ui-calendar-header-next" name="next" data-date="{0}-{1}"><span class="fa fa-chevron-right"></span></button></div><table cellpadding="0" cellspacing="0" border="0"><thead>{4}</thead><tbody>{5}</tbody></table>'.format(output.year,output.month,self.months[value.getMonth()],value.getFullYear(),header.join(''),builder.join(''))+(self.today?'<div><a href="javascript:void(0)" class="ui-calendar-today">'+self.today+'</a></div>':''))}});COMPONENT('lazyload',function(){var self=this;var selector,container,offset;self.readonly();self.make=function(){selector=self.attr('data-selector');offset=+(self.attr('data-offset')||50);container= $(self.attr('data-container')||window);container.on('scroll',self.refresh);setTimeout(function(){self.refresh()},1000)};self.refresh=function(){!self.release()&&setTimeout2(self.id,self.prepare,200)};self.released=self.refresh;self.setter=self.refresh;self.prepare=function(){var scroll=container.scrollTop();var beg=scroll-offset;var end=beg+container.height()+offset;self.find(selector).each(function(){if(this.getAttribute('data-lazyload'))return;var el= $(this);var top=(container!==window?scroll:0)+el.offset().top;if(top>=beg&&top<=end){el.attr('data-lazyload',true);EXEC(self.attr('data-exec'),el)}})}});MAIN.formatter(function(path,value,type){if(type==='date'){if(value instanceof Date)return value.format(this.attr('data-jc-format'));return value?new Date(Date.parse(value)).format(this.attr('data-jc-format')):value}if(type!=='currency')return value;if(typeof(value)!=='number'){value=parseFloat(value);if(isNaN(value))value=0}return value.format(2)});function insertTextarea(el,text){var val=el.value,endIndex,range;if(el.selectionStart!==undefined&&el.selectionEnd!==undefined){endIndex=el.selectionEnd;el.value=val.slice(0,el.selectionStart)+text+val.slice(endIndex);el.selectionStart=el.selectionEnd=endIndex+text.length}else if(document.selection!==undefined&&document.selection.createRange!==undefined){el.focus();range=document.selection.createRange();range.collapse(false);range.text=text;range.select()}};


/*
 * ===========================================================================================
 * MERGED: /Users/bruce/Dev/study/totaljs/messanger/public/js/default.js
 * ===========================================================================================
 */

var MARKDOWN={};var REGEXP={};REGEXP.tag=/(<([^>]+)>)/ig;REGEXP.smiles=/&lt;i\sclass=&quot;(smiles|fa).*?&lt;\/i&gt;/g;REGEXP.users=/(\s|\<)?@[a-z0-9\-]+(\s|\>)?/g;REGEXP.table=/<table/g;REGEXP.quotes=/&quot;/g;REGEXP.g=/&gt;/g;REGEXP.l=/&lt;/g;REGEXP.fa=/"fa\s/g;marked.setOptions({gfm:true,breaks:true,sanitize:true,tables:true});$(document).ready(function(){setTimeout(function(){EMIT('resize')},100)});$(window).on('resize',function(){EMIT('resize')});ON('resize',function(){var $w= $(window);var height= $w.height();var msgbox= $('#messagebox');if(!msgbox.length)return;if(msgbox.hasClass('hidden'))msgbox=0;else msgbox=msgbox.height();var header= $('#header').height();$('#content').css({'margin-top':header}).css('height',height-header-(msgbox));var tmp= $('#panel');tmp.css('height',height-tmp.offset().top)});function highlight(el){$(el).find('pre code').each(function(i,block){hljs.highlightBlock(block)});return el}function scrollBottom(){var el= $('#content');el.scrollTop(el.get(0).scrollHeight)}Tangular.register('markdown',function(value){var xss=marked_xss_parse(value,this.user.sa);MARKDOWN.message=this;MARKDOWN.html=marked(marked_features(xss.body)).replace(REGEXP.smiles,function(text){return text.replace(REGEXP.l,'<').replace(REGEXP.g,'>').replace(REGEXP.quotes,'"')}).replace(/<img/g,'<img class="img-responsive"').replace(REGEXP.table,'<table class="table table-bordered"').replace(/<a\s/g,'<a target="_blank"');if(!MARKDOWN.html.replace(REGEXP.tag,'').trim())MARKDOWN.html=MARKDOWN.html.replace(REGEXP.fa,'"fa fa-2x ');MARKDOWN.html=MARKDOWN.html.replace(REGEXP.users,function(text){var index=text.indexOf('@');var l=text.substring(text.length-1);var u=current.users.findItem('linker',text.substring(index+1).trim());if(l!==' '&&l!=='>')l='';return u?((text.substring(0,index)+'<a href="javascript:void(0)" class="b userlinker" data-linker="{2}">{1}</a>'.format(u.picture,Tangular.helpers.encode(u.name),u.linker))+l):text}).trim();xss.body=MARKDOWN.html;MARKDOWN.html=marked_xss_inject(xss,this.user.sa);WORKFLOW('messenger.render')(MARKDOWN);return MARKDOWN.html});function marked_xss_parse(body,can){var xss_script=/<script.*?>.*?<\/script>/igm;var beg=-1;var obj={};obj.body=body;obj.cache=[];if(!can)return obj;while(true){beg=obj.body.indexOf('```xss',beg);if(beg===-1)return obj;var end=obj.body.indexOf('```',beg+6);if(end===-1)return obj;obj.cache.push(obj.body.substring(beg+6,end).replace(xss_script,''));obj.body=obj.body.substring(0,beg)+'$$'+(obj.cache.length-1)+'$$'+obj.body.substring(end+3)}}function marked_xss_inject(obj,can){return can?obj.body.replace(/\$\$\d+\$\$/g,function(id){return obj.cache[+id.replace(/\$/g,'')]}):obj.body}function marked_features(str){var builder=[];var beg=0;var skip=false;for(var i=0,length=str.length;i<length;i++){var c=String.fromCharCode(str.charCodeAt(i));if(c==='`'){!skip&&builder.push(smilefy(mailify(urlify(str.substring(beg,i)))));skip=!skip;!skip&&(beg=i+1);builder.push(c)}else if(skip)builder.push(c)}var tmp=str.substring(beg,str.length);tmp&&builder.push(smilefy(mailify(urlify(tmp))));return builder.join('')}function smilefy(str){var db={':-)':1,':)':1,';)':8,':D':0,'8)':5,':((':7,':(':3,':|':2,':P':6,':O':4,':*':9,'+1':10,'1':11,'\/':12};return str.replace(/(\-1|[:;8O\-)DP(|\*]|\+1){1,3}/g,function(match){if(match==='-1')return match;var smile=db[match.replace('-','')];return smile===undefined?match:'<i class="smiles smiles-'+smile+'"></i>'}).replace(/\:[a-z0-9\-]+\:/g,function(text){return'<i class="fa fa-'+text.substring(1,text.length-1)+'"></i>'})}function urlify(str,a){return str.replace(/(((https?:\/\/)|(www\.))[^\s]+)/g,function(url,b,c){var l=url.substring(url.length-1,url.length);var p=url.substring(url.length-2,url.length-1);if(l===')'||l==='>'||p===')'||p==='>')return url;var len=url.length;l=url.substring(len-1);if(l===')')return url;if(l==='.'||l===',')url=url.substring(0,len-1);else l='';var raw=url;url=c==='www.'?'http://'+url:url;return(a?'<a href="{0}" target="_blank">{1}</a>'.format(url,raw):'['+raw+']('+url+')')+l})}function mailify(str,a){return str.replace(/(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])/g,function(m){var len=m.length;var l=m.substring(len-1);if(l==='.'||l===',')m=m.substring(0,len-1);else l='';return(a?'<a href="mailto:{0}">{0}</a>'.format(m):'['+m+'](mailto:'+m+')')+l})}function hashtagify(str){var beg=-1;while(true){beg=str.indexOf('#',beg);if(beg===-1)return str;var p=str.substring(beg-1,beg);if(p&&p!==' '){beg++;continue}var end=str.length;for(var i=beg;i<beg+15;i++){var c=str.charCodeAt(i);switch(c){case 32:case 44:case 45:case 46:case 58:case 59:end=i;break}}var hash=str.substring(beg,end);str=str.replace(hash,'')}}function findfiles(str){var match=str.match(/\[.*?\]\(\/download\/.*?\)/g);if(!match)return null;var files=[];for(var i=0,length=match.length;i<length;i++){var text=match[i].trim();var index=text.indexOf('(');var name=text.substring(1,index-1);var url=text.substring(index+1,text.length-1);files.push({name:name,url:url})}return files}function findusers(str){var match=str.match(REGEXP.users);if(!match)return null;var users={};var is=false;for(var i=0,length=match.length;i<length;i++){var text=match[i].trim();var beg=text.indexOf('@');var end=text.indexOf(' ',beg);text=text.substring(beg+1,end===-1?text.length:end);var user=current.users.findItem('linker',text);if(user){is=true;users[user.id]=true}}return is?users:null}function newest(a,b){return a.substring(0,14).parseInt()>=b.substring(0,14).parseInt()}Tangular.register('body',function(value){return smilefy(urlify(mailify(value.replace(/\`.*?\`/g,function(text){return'<code>'+text.replace(/\`/g,'')+'</code>'}),true),true))});Tangular.register('def',function(value,def){return value===''||value==null?def:value});function marked_video(selector){selector.find('.lang-video').each(function(){var el= $(this);var html=el.html();if(html.indexOf('youtube')!==-1)el.parent().replaceWith('<div class="video-container"><div class="video"><iframe src="https://www.youtube.com/embed/'+Tangular.helpers.encode(html.split('v=')[1]||'')+'" frameborder="0" allowfullscreen></iframe></div></div>');else if(html.indexOf('vimeo')!==-1)el.parent().replaceWith('<div class="video-container"><div class="video"><iframe src="//player.vimeo.com/video/'+Tangular.helpers.encode(html.substring(html.lastIndexOf('/')+1))+'" frameborder="0" allowfullscreen></iframe></div></div>')})}function marked_iframe(selector){selector.find('.lang-iframe').each(function(){var el= $(this);el.parent().replaceWith('<div class="iframe"><iframe src="'+Tangular.helpers.encode(el.html())+'" frameborder="0"></iframe></div>')})}(function(mod){mod(CodeMirror)})(function(CodeMirror){'use strict';CodeMirror.defineOption('autoSuggest',[],function(cm,value){cm.on('inputRead',function(cm,change){var mode=cm.getModeAt(cm.getCursor());for(var i=0,len=value.length;i<len;i++){if(mode.name===value[i].mode&&change.text[0]===value[i].startChar){(function(i){cm.showHint({completeSingle:false,hint:function(cm){var cur=cm.getCursor();var token=cm.getTokenAt(cur);var start=token.start+1;var end=token.end;return{list:value[i].listCallback(cm.getValue().substring(start,end)),from:CodeMirror.Pos(cur.line,start),to:CodeMirror.Pos(cur.line,end)}}})})(i)}}})})});!function(a){"object"==typeof exports&&"object"==typeof module?a(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],a):a(CodeMirror)}(function(a){function b(a){a.state.placeholder&&(a.state.placeholder.parentNode.removeChild(a.state.placeholder),a.state.placeholder=null)}function c(a){b(a);var c=a.state.placeholder=document.createElement("pre");c.style.cssText="height: 0; overflow: visible",c.className="CodeMirror-placeholder";var d=a.getOption("placeholder");"string"==typeof d&&(d=document.createTextNode(d)),c.appendChild(d),a.display.lineSpace.insertBefore(c,a.display.lineSpace.firstChild)}function d(a){f(a)&&c(a)}function e(a){var d=a.getWrapperElement(),e=f(a);d.className=d.className.replace(" CodeMirror-empty","")+(e?" CodeMirror-empty":""),e?c(a):b(a)}function f(a){return 1===a.lineCount()&&""===a.getLine(0)}a.defineOption("placeholder","",function(c,f,g){var h=g&&g!=a.Init;if(f&&!h)c.on("blur",d),c.on("change",e),c.on("swapDoc",e),e(c);else if(!f&&h){c.off("blur",d),c.off("change",e),c.off("swapDoc",e),b(c);var i=c.getWrapperElement();i.className=i.className.replace(" CodeMirror-empty","")}f&&!c.hasFocus()&&d(c)})});